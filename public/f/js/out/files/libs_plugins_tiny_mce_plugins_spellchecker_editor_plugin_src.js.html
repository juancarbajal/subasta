<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>libs&#x2F;plugins&#x2F;tiny_mce&#x2F;plugins&#x2F;spellchecker&#x2F;editor_plugin_src.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.7.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.7.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/admin.html">admin</a></li>
            
                <li><a href="..&#x2F;classes/all-modules.html">all-modules</a></li>
            
                <li><a href="..&#x2F;classes/default.html">default</a></li>
            
                <li><a href="..&#x2F;classes/jcarousel.html">jcarousel</a></li>
            
                <li><a href="..&#x2F;classes/tinymce.plugins.AutoSave.html">tinymce.plugins.AutoSave</a></li>
            
                <li><a href="..&#x2F;classes/tinymce.plugins.ContextMenu.html">tinymce.plugins.ContextMenu</a></li>
            
                <li><a href="..&#x2F;classes/usuario.html">usuario</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/ad-actions.html">ad-actions</a></li>
            
                <li><a href="..&#x2F;modules/add-class-middle.html">add-class-middle</a></li>
            
                <li><a href="..&#x2F;modules/add-favorites.html">add-favorites</a></li>
            
                <li><a href="..&#x2F;modules/all-checked-uncheked.html">all-checked-uncheked</a></li>
            
                <li><a href="..&#x2F;modules/banner-top classified.html">banner-top classified</a></li>
            
                <li><a href="..&#x2F;modules/carousel-products.html">carousel-products</a></li>
            
                <li><a href="..&#x2F;modules/count-word.html">count-word</a></li>
            
                <li><a href="..&#x2F;modules/data-ubigeo.html">data-ubigeo</a></li>
            
                <li><a href="..&#x2F;modules/geotags.html">geotags</a></li>
            
                <li><a href="..&#x2F;modules/impress-ad-list.html">impress-ad-list</a></li>
            
                <li><a href="..&#x2F;modules/lightbox-logIn-signUp.html">lightbox-logIn-signUp</a></li>
            
                <li><a href="..&#x2F;modules/moduleName.html">moduleName</a></li>
            
                <li><a href="..&#x2F;modules/placeholder.html">placeholder</a></li>
            
                <li><a href="..&#x2F;modules/preview-impress.html">preview-impress</a></li>
            
                <li><a href="..&#x2F;modules/register-category.html">register-category</a></li>
            
                <li><a href="..&#x2F;modules/remove-class-home.html">remove-class-home</a></li>
            
                <li><a href="..&#x2F;modules/report-ad.html">report-ad</a></li>
            
                <li><a href="..&#x2F;modules/scrollTop.html">scrollTop</a></li>
            
                <li><a href="..&#x2F;modules/search-categories.html">search-categories</a></li>
            
                <li><a href="..&#x2F;modules/send-ad-friend.html">send-ad-friend</a></li>
            
                <li><a href="..&#x2F;modules/send-list-ad-email.html">send-list-ad-email</a></li>
            
                <li><a href="..&#x2F;modules/show-advanced-search.html">show-advanced-search</a></li>
            
                <li><a href="..&#x2F;modules/show-example-ads.html">show-example-ads</a></li>
            
                <li><a href="..&#x2F;modules/show-login-trigger.html">show-login-trigger</a></li>
            
                <li><a href="..&#x2F;modules/show-photo-products.html">show-photo-products</a></li>
            
                <li><a href="..&#x2F;modules/show-popup.html">show-popup</a></li>
            
                <li><a href="..&#x2F;modules/show-questions.html">show-questions</a></li>
            
                <li><a href="..&#x2F;modules/show-register-trigger.html">show-register-trigger</a></li>
            
                <li><a href="..&#x2F;modules/show-video.html">show-video</a></li>
            
                <li><a href="..&#x2F;modules/showMoreCategories.html">showMoreCategories</a></li>
            
                <li><a href="..&#x2F;modules/some-module4.html">some-module4</a></li>
            
                <li><a href="..&#x2F;modules/tinymce-register.html">tinymce-register</a></li>
            
                <li><a href="..&#x2F;modules/uploader-photos.html">uploader-photos</a></li>
            
                <li><a href="..&#x2F;modules/validate.html">validate</a></li>
            
                <li><a href="..&#x2F;modules/validate-document.html">validate-document</a></li>
            
                <li><a href="..&#x2F;modules/validate-image.html">validate-image</a></li>
            
                <li><a href="..&#x2F;modules/venta.html">venta</a></li>
            
                <li><a href="..&#x2F;modules/yOSON.html">yOSON</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: libs&#x2F;plugins&#x2F;tiny_mce&#x2F;plugins&#x2F;spellchecker&#x2F;editor_plugin_src.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * editor_plugin_src.js
 *
 * Copyright 2009, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http:&#x2F;&#x2F;tinymce.moxiecode.com&#x2F;license
 * Contributing: http:&#x2F;&#x2F;tinymce.moxiecode.com&#x2F;contributing
 *&#x2F;

(function() {
	var JSONRequest = tinymce.util.JSONRequest, each = tinymce.each, DOM = tinymce.DOM;

	tinymce.create(&#x27;tinymce.plugins.SpellcheckerPlugin&#x27;, {
		getInfo : function() {
			return {
				longname : &#x27;Spellchecker&#x27;,
				author : &#x27;Moxiecode Systems AB&#x27;,
				authorurl : &#x27;http:&#x2F;&#x2F;tinymce.moxiecode.com&#x27;,
				infourl : &#x27;http:&#x2F;&#x2F;wiki.moxiecode.com&#x2F;index.php&#x2F;TinyMCE:Plugins&#x2F;spellchecker&#x27;,
				version : tinymce.majorVersion + &quot;.&quot; + tinymce.minorVersion
			};
		},

		init : function(ed, url) {
			var t = this, cm;

			t.url = url;
			t.editor = ed;
			t.rpcUrl = ed.getParam(&quot;spellchecker_rpc_url&quot;, &quot;{backend}&quot;);

			if (t.rpcUrl == &#x27;{backend}&#x27;) {
				&#x2F;&#x2F; Sniff if the browser supports native spellchecking (Don&#x27;t know of a better way)
				if (tinymce.isIE)
					return;

				t.hasSupport = true;

				&#x2F;&#x2F; Disable the context menu when spellchecking is active
				ed.onContextMenu.addToTop(function(ed, e) {
					if (t.active)
						return false;
				});
			}

			&#x2F;&#x2F; Register commands
			ed.addCommand(&#x27;mceSpellCheck&#x27;, function() {
				if (t.rpcUrl == &#x27;{backend}&#x27;) {
					&#x2F;&#x2F; Enable&#x2F;disable native spellchecker
					t.editor.getBody().spellcheck = t.active = !t.active;
					return;
				}

				if (!t.active) {
					ed.setProgressState(1);
					t._sendRPC(&#x27;checkWords&#x27;, [t.selectedLang, t._getWords()], function(r) {
						if (r.length &gt; 0) {
							t.active = 1;
							t._markWords(r);
							ed.setProgressState(0);
							ed.nodeChanged();
						} else {
							ed.setProgressState(0);

							if (ed.getParam(&#x27;spellchecker_report_no_misspellings&#x27;, true))
								ed.windowManager.alert(&#x27;spellchecker.no_mpell&#x27;);
						}
					});
				} else
					t._done();
			});

			if (ed.settings.content_css !== false)
				ed.contentCSS.push(url + &#x27;&#x2F;css&#x2F;content.css&#x27;);

			ed.onClick.add(t._showMenu, t);
			ed.onContextMenu.add(t._showMenu, t);
			ed.onBeforeGetContent.add(function() {
				if (t.active)
					t._removeWords();
			});

			ed.onNodeChange.add(function(ed, cm) {
				cm.setActive(&#x27;spellchecker&#x27;, t.active);
			});

			ed.onSetContent.add(function() {
				t._done();
			});

			ed.onBeforeGetContent.add(function() {
				t._done();
			});

			ed.onBeforeExecCommand.add(function(ed, cmd) {
				if (cmd == &#x27;mceFullScreen&#x27;)
					t._done();
			});

			&#x2F;&#x2F; Find selected language
			t.languages = {};
			each(ed.getParam(&#x27;spellchecker_languages&#x27;, &#x27;+English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr,German=de,Italian=it,Polish=pl,Portuguese=pt,Spanish=es,Swedish=sv&#x27;, &#x27;hash&#x27;), function(v, k) {
				if (k.indexOf(&#x27;+&#x27;) === 0) {
					k = k.substring(1);
					t.selectedLang = v;
				}

				t.languages[k] = v;
			});
		},

		createControl : function(n, cm) {
			var t = this, c, ed = t.editor;

			if (n == &#x27;spellchecker&#x27;) {
				&#x2F;&#x2F; Use basic button if we use the native spellchecker
				if (t.rpcUrl == &#x27;{backend}&#x27;) {
					&#x2F;&#x2F; Create simple toggle button if we have native support
					if (t.hasSupport)
						c = cm.createButton(n, {title : &#x27;spellchecker.desc&#x27;, cmd : &#x27;mceSpellCheck&#x27;, scope : t});

					return c;
				}

				c = cm.createSplitButton(n, {title : &#x27;spellchecker.desc&#x27;, cmd : &#x27;mceSpellCheck&#x27;, scope : t});

				c.onRenderMenu.add(function(c, m) {
					m.add({title : &#x27;spellchecker.langs&#x27;, &#x27;class&#x27; : &#x27;mceMenuItemTitle&#x27;}).setDisabled(1);
					each(t.languages, function(v, k) {
						var o = {icon : 1}, mi;

						o.onclick = function() {
							if (v == t.selectedLang) {
								return;
							}
							mi.setSelected(1);
							t.selectedItem.setSelected(0);
							t.selectedItem = mi;
							t.selectedLang = v;
						};

						o.title = k;
						mi = m.add(o);
						mi.setSelected(v == t.selectedLang);

						if (v == t.selectedLang)
							t.selectedItem = mi;
					})
				});

				return c;
			}
		},

		&#x2F;&#x2F; Internal functions

		_walk : function(n, f) {
			var d = this.editor.getDoc(), w;

			if (d.createTreeWalker) {
				w = d.createTreeWalker(n, NodeFilter.SHOW_TEXT, null, false);

				while ((n = w.nextNode()) != null)
					f.call(this, n);
			} else
				tinymce.walk(n, f, &#x27;childNodes&#x27;);
		},

		_getSeparators : function() {
			var re = &#x27;&#x27;, i, str = this.editor.getParam(&#x27;spellchecker_word_separator_chars&#x27;, &#x27;\\s!&quot;#$%&amp;()*+,-.&#x2F;:;&lt;=&gt;?@[\]^_{|}����������������\u201d\u201c&#x27;);

			&#x2F;&#x2F; Build word separator regexp
			for (i=0; i&lt;str.length; i++)
				re += &#x27;\\&#x27; + str.charAt(i);

			return re;
		},

		_getWords : function() {
			var ed = this.editor, wl = [], tx = &#x27;&#x27;, lo = {}, rawWords = [];

			&#x2F;&#x2F; Get area text
			this._walk(ed.getBody(), function(n) {
				if (n.nodeType == 3)
					tx += n.nodeValue + &#x27; &#x27;;
			});

			&#x2F;&#x2F; split the text up into individual words
			if (ed.getParam(&#x27;spellchecker_word_pattern&#x27;)) {
				&#x2F;&#x2F; look for words that match the pattern
				rawWords = tx.match(&#x27;(&#x27; + ed.getParam(&#x27;spellchecker_word_pattern&#x27;) + &#x27;)&#x27;, &#x27;gi&#x27;);
			} else {
				&#x2F;&#x2F; Split words by separator
				tx = tx.replace(new RegExp(&#x27;([0-9]|[&#x27; + this._getSeparators() + &#x27;])&#x27;, &#x27;g&#x27;), &#x27; &#x27;);
				tx = tinymce.trim(tx.replace(&#x2F;(\s+)&#x2F;g, &#x27; &#x27;));
				rawWords = tx.split(&#x27; &#x27;);
			}

			&#x2F;&#x2F; Build word array and remove duplicates
			each(rawWords, function(v) {
				if (!lo[v]) {
					wl.push(v);
					lo[v] = 1;
				}
			});

			return wl;
		},

		_removeWords : function(w) {
			var ed = this.editor, dom = ed.dom, se = ed.selection, r = se.getRng(true);

			each(dom.select(&#x27;span&#x27;).reverse(), function(n) {
				if (n &amp;&amp; (dom.hasClass(n, &#x27;mceItemHiddenSpellWord&#x27;) || dom.hasClass(n, &#x27;mceItemHidden&#x27;))) {
					if (!w || dom.decode(n.innerHTML) == w)
						dom.remove(n, 1);
				}
			});

			se.setRng(r);
		},

		_markWords : function(wl) {
			var ed = this.editor, dom = ed.dom, doc = ed.getDoc(), se = ed.selection, r = se.getRng(true), nl = [],
				w = wl.join(&#x27;|&#x27;), re = this._getSeparators(), rx = new RegExp(&#x27;(^|[&#x27; + re + &#x27;])(&#x27; + w + &#x27;)(?=[&#x27; + re + &#x27;]|$)&#x27;, &#x27;g&#x27;);

			&#x2F;&#x2F; Collect all text nodes
			this._walk(ed.getBody(), function(n) {
				if (n.nodeType == 3) {
					nl.push(n);
				}
			});

			&#x2F;&#x2F; Wrap incorrect words in spans
			each(nl, function(n) {
				var node, elem, txt, pos, v = n.nodeValue;

				if (rx.test(v)) {
					&#x2F;&#x2F; Encode the content
					v = dom.encode(v);
					&#x2F;&#x2F; Create container element
					elem = dom.create(&#x27;span&#x27;, {&#x27;class&#x27; : &#x27;mceItemHidden&#x27;});

					&#x2F;&#x2F; Following code fixes IE issues by creating text nodes
					&#x2F;&#x2F; using DOM methods instead of innerHTML.
					&#x2F;&#x2F; Bug #3124: &lt;PRE&gt; elements content is broken after spellchecking.
					&#x2F;&#x2F; Bug #1408: Preceding whitespace characters are removed
					&#x2F;&#x2F; @TODO: I&#x27;m not sure that both are still issues on IE9.
					if (tinymce.isIE) {
						&#x2F;&#x2F; Enclose mispelled words with temporal tag
						v = v.replace(rx, &#x27;$1&lt;mcespell&gt;$2&lt;&#x2F;mcespell&gt;&#x27;);
						&#x2F;&#x2F; Loop over the content finding mispelled words
						while ((pos = v.indexOf(&#x27;&lt;mcespell&gt;&#x27;)) != -1) {
							&#x2F;&#x2F; Add text node for the content before the word
							txt = v.substring(0, pos);
							if (txt.length) {
								node = doc.createTextNode(dom.decode(txt));
								elem.appendChild(node);
							}
							v = v.substring(pos+10);
							pos = v.indexOf(&#x27;&lt;&#x2F;mcespell&gt;&#x27;);
							txt = v.substring(0, pos);
							v = v.substring(pos+11);
							&#x2F;&#x2F; Add span element for the word
							elem.appendChild(dom.create(&#x27;span&#x27;, {&#x27;class&#x27; : &#x27;mceItemHiddenSpellWord&#x27;}, txt));
						}
						&#x2F;&#x2F; Add text node for the rest of the content
						if (v.length) {
							node = doc.createTextNode(dom.decode(v));
							elem.appendChild(node);
						}
					} else {
						&#x2F;&#x2F; Other browsers preserve whitespace characters on innerHTML usage
						elem.innerHTML = v.replace(rx, &#x27;$1&lt;span class=&quot;mceItemHiddenSpellWord&quot;&gt;$2&lt;&#x2F;span&gt;&#x27;);
					}

					&#x2F;&#x2F; Finally, replace the node with the container
					dom.replace(elem, n);
				}
			});

			se.setRng(r);
		},

		_showMenu : function(ed, e) {
			var t = this, ed = t.editor, m = t._menu, p1, dom = ed.dom, vp = dom.getViewPort(ed.getWin()), wordSpan = e.target;

			e = 0; &#x2F;&#x2F; Fixes IE memory leak

			if (!m) {
				m = ed.controlManager.createDropMenu(&#x27;spellcheckermenu&#x27;, {&#x27;class&#x27; : &#x27;mceNoIcons&#x27;});
				t._menu = m;
			}

			if (dom.hasClass(wordSpan, &#x27;mceItemHiddenSpellWord&#x27;)) {
				m.removeAll();
				m.add({title : &#x27;spellchecker.wait&#x27;, &#x27;class&#x27; : &#x27;mceMenuItemTitle&#x27;}).setDisabled(1);

				t._sendRPC(&#x27;getSuggestions&#x27;, [t.selectedLang, dom.decode(wordSpan.innerHTML)], function(r) {
					var ignoreRpc;

					m.removeAll();

					if (r.length &gt; 0) {
						m.add({title : &#x27;spellchecker.sug&#x27;, &#x27;class&#x27; : &#x27;mceMenuItemTitle&#x27;}).setDisabled(1);
						each(r, function(v) {
							m.add({title : v, onclick : function() {
								dom.replace(ed.getDoc().createTextNode(v), wordSpan);
								t._checkDone();
							}});
						});

						m.addSeparator();
					} else
						m.add({title : &#x27;spellchecker.no_sug&#x27;, &#x27;class&#x27; : &#x27;mceMenuItemTitle&#x27;}).setDisabled(1);

					if (ed.getParam(&#x27;show_ignore_words&#x27;, true)) {
						ignoreRpc = t.editor.getParam(&quot;spellchecker_enable_ignore_rpc&quot;, &#x27;&#x27;);
						m.add({
							title : &#x27;spellchecker.ignore_word&#x27;,
							onclick : function() {
								var word = wordSpan.innerHTML;

								dom.remove(wordSpan, 1);
								t._checkDone();

								&#x2F;&#x2F; tell the server if we need to
								if (ignoreRpc) {
									ed.setProgressState(1);
									t._sendRPC(&#x27;ignoreWord&#x27;, [t.selectedLang, word], function(r) {
										ed.setProgressState(0);
									});
								}
							}
						});

						m.add({
							title : &#x27;spellchecker.ignore_words&#x27;,
							onclick : function() {
								var word = wordSpan.innerHTML;

								t._removeWords(dom.decode(word));
								t._checkDone();

								&#x2F;&#x2F; tell the server if we need to
								if (ignoreRpc) {
									ed.setProgressState(1);
									t._sendRPC(&#x27;ignoreWords&#x27;, [t.selectedLang, word], function(r) {
										ed.setProgressState(0);
									});
								}
							}
						});
					}

					if (t.editor.getParam(&quot;spellchecker_enable_learn_rpc&quot;)) {
						m.add({
							title : &#x27;spellchecker.learn_word&#x27;,
							onclick : function() {
								var word = wordSpan.innerHTML;

								dom.remove(wordSpan, 1);
								t._checkDone();

								ed.setProgressState(1);
								t._sendRPC(&#x27;learnWord&#x27;, [t.selectedLang, word], function(r) {
									ed.setProgressState(0);
								});
							}
						});
					}

					m.update();
				});

				p1 = DOM.getPos(ed.getContentAreaContainer());
				m.settings.offset_x = p1.x;
				m.settings.offset_y = p1.y;

				ed.selection.select(wordSpan);
				p1 = dom.getPos(wordSpan);
				m.showMenu(p1.x, p1.y + wordSpan.offsetHeight - vp.y);

				return tinymce.dom.Event.cancel(e);
			} else
				m.hideMenu();
		},

		_checkDone : function() {
			var t = this, ed = t.editor, dom = ed.dom, o;

			each(dom.select(&#x27;span&#x27;), function(n) {
				if (n &amp;&amp; dom.hasClass(n, &#x27;mceItemHiddenSpellWord&#x27;)) {
					o = true;
					return false;
				}
			});

			if (!o)
				t._done();
		},

		_done : function() {
			var t = this, la = t.active;

			if (t.active) {
				t.active = 0;
				t._removeWords();

				if (t._menu)
					t._menu.hideMenu();

				if (la)
					t.editor.nodeChanged();
			}
		},

		_sendRPC : function(m, p, cb) {
			var t = this;

			JSONRequest.sendRPC({
				url : t.rpcUrl,
				method : m,
				params : p,
				success : cb,
				error : function(e, x) {
					t.editor.setProgressState(0);
					t.editor.windowManager.alert(e.errstr || (&#x27;Error response: &#x27; + x.responseText));
				}
			});
		}
	});

	&#x2F;&#x2F; Register plugin
	tinymce.PluginManager.add(&#x27;spellchecker&#x27;, tinymce.plugins.SpellcheckerPlugin);
})();

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
