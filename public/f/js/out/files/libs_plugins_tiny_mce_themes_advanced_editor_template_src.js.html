<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>libs&#x2F;plugins&#x2F;tiny_mce&#x2F;themes&#x2F;advanced&#x2F;editor_template_src.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.7.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.7.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/admin.html">admin</a></li>
            
                <li><a href="..&#x2F;classes/all-modules.html">all-modules</a></li>
            
                <li><a href="..&#x2F;classes/default.html">default</a></li>
            
                <li><a href="..&#x2F;classes/jcarousel.html">jcarousel</a></li>
            
                <li><a href="..&#x2F;classes/tinymce.plugins.AutoSave.html">tinymce.plugins.AutoSave</a></li>
            
                <li><a href="..&#x2F;classes/tinymce.plugins.ContextMenu.html">tinymce.plugins.ContextMenu</a></li>
            
                <li><a href="..&#x2F;classes/usuario.html">usuario</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/ad-actions.html">ad-actions</a></li>
            
                <li><a href="..&#x2F;modules/add-class-middle.html">add-class-middle</a></li>
            
                <li><a href="..&#x2F;modules/add-favorites.html">add-favorites</a></li>
            
                <li><a href="..&#x2F;modules/all-checked-uncheked.html">all-checked-uncheked</a></li>
            
                <li><a href="..&#x2F;modules/banner-top classified.html">banner-top classified</a></li>
            
                <li><a href="..&#x2F;modules/carousel-products.html">carousel-products</a></li>
            
                <li><a href="..&#x2F;modules/count-word.html">count-word</a></li>
            
                <li><a href="..&#x2F;modules/data-ubigeo.html">data-ubigeo</a></li>
            
                <li><a href="..&#x2F;modules/geotags.html">geotags</a></li>
            
                <li><a href="..&#x2F;modules/impress-ad-list.html">impress-ad-list</a></li>
            
                <li><a href="..&#x2F;modules/lightbox-logIn-signUp.html">lightbox-logIn-signUp</a></li>
            
                <li><a href="..&#x2F;modules/moduleName.html">moduleName</a></li>
            
                <li><a href="..&#x2F;modules/placeholder.html">placeholder</a></li>
            
                <li><a href="..&#x2F;modules/preview-impress.html">preview-impress</a></li>
            
                <li><a href="..&#x2F;modules/register-category.html">register-category</a></li>
            
                <li><a href="..&#x2F;modules/remove-class-home.html">remove-class-home</a></li>
            
                <li><a href="..&#x2F;modules/report-ad.html">report-ad</a></li>
            
                <li><a href="..&#x2F;modules/scrollTop.html">scrollTop</a></li>
            
                <li><a href="..&#x2F;modules/search-categories.html">search-categories</a></li>
            
                <li><a href="..&#x2F;modules/send-ad-friend.html">send-ad-friend</a></li>
            
                <li><a href="..&#x2F;modules/send-list-ad-email.html">send-list-ad-email</a></li>
            
                <li><a href="..&#x2F;modules/show-advanced-search.html">show-advanced-search</a></li>
            
                <li><a href="..&#x2F;modules/show-example-ads.html">show-example-ads</a></li>
            
                <li><a href="..&#x2F;modules/show-login-trigger.html">show-login-trigger</a></li>
            
                <li><a href="..&#x2F;modules/show-photo-products.html">show-photo-products</a></li>
            
                <li><a href="..&#x2F;modules/show-popup.html">show-popup</a></li>
            
                <li><a href="..&#x2F;modules/show-questions.html">show-questions</a></li>
            
                <li><a href="..&#x2F;modules/show-register-trigger.html">show-register-trigger</a></li>
            
                <li><a href="..&#x2F;modules/show-video.html">show-video</a></li>
            
                <li><a href="..&#x2F;modules/showMoreCategories.html">showMoreCategories</a></li>
            
                <li><a href="..&#x2F;modules/some-module4.html">some-module4</a></li>
            
                <li><a href="..&#x2F;modules/tinymce-register.html">tinymce-register</a></li>
            
                <li><a href="..&#x2F;modules/uploader-photos.html">uploader-photos</a></li>
            
                <li><a href="..&#x2F;modules/validate.html">validate</a></li>
            
                <li><a href="..&#x2F;modules/validate-document.html">validate-document</a></li>
            
                <li><a href="..&#x2F;modules/validate-image.html">validate-image</a></li>
            
                <li><a href="..&#x2F;modules/venta.html">venta</a></li>
            
                <li><a href="..&#x2F;modules/yOSON.html">yOSON</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: libs&#x2F;plugins&#x2F;tiny_mce&#x2F;themes&#x2F;advanced&#x2F;editor_template_src.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * editor_template_src.js
 *
 * Copyright 2009, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http:&#x2F;&#x2F;tinymce.moxiecode.com&#x2F;license
 * Contributing: http:&#x2F;&#x2F;tinymce.moxiecode.com&#x2F;contributing
 *&#x2F;

(function(tinymce) {
	var DOM = tinymce.DOM, Event = tinymce.dom.Event, extend = tinymce.extend, each = tinymce.each, Cookie = tinymce.util.Cookie, lastExtID, explode = tinymce.explode;

	&#x2F;&#x2F; Generates a preview for a format
	function getPreviewCss(ed, fmt) {
		var name, previewElm, dom = ed.dom, previewCss = &#x27;&#x27;, parentFontSize, previewStylesName;

		previewStyles = ed.settings.preview_styles;

		&#x2F;&#x2F; No preview forced
		if (previewStyles === false)
			return &#x27;&#x27;;

		&#x2F;&#x2F; Default preview
		if (!previewStyles)
			previewStyles = &#x27;font-family font-size font-weight text-decoration text-transform color background-color&#x27;;

		&#x2F;&#x2F; Removes any variables since these can&#x27;t be previewed
		function removeVars(val) {
			return val.replace(&#x2F;%(\w+)&#x2F;g, &#x27;&#x27;);
		};

		&#x2F;&#x2F; Create block&#x2F;inline element to use for preview
		name = fmt.block || fmt.inline || &#x27;span&#x27;;
		previewElm = dom.create(name);

		&#x2F;&#x2F; Add format styles to preview element
		each(fmt.styles, function(value, name) {
			value = removeVars(value);

			if (value)
				dom.setStyle(previewElm, name, value);
		});

		&#x2F;&#x2F; Add attributes to preview element
		each(fmt.attributes, function(value, name) {
			value = removeVars(value);

			if (value)
				dom.setAttrib(previewElm, name, value);
		});

		&#x2F;&#x2F; Add classes to preview element
		each(fmt.classes, function(value) {
			value = removeVars(value);

			if (!dom.hasClass(previewElm, value))
				dom.addClass(previewElm, value);
		});

		&#x2F;&#x2F; Add the previewElm outside the visual area
		dom.setStyles(previewElm, {position: &#x27;absolute&#x27;, left: -0xFFFF});
		ed.getBody().appendChild(previewElm);

		&#x2F;&#x2F; Get parent container font size so we can compute px values out of em&#x2F;% for older IE:s
		parentFontSize = dom.getStyle(ed.getBody(), &#x27;fontSize&#x27;, true);
		parentFontSize = &#x2F;px$&#x2F;.test(parentFontSize) ? parseInt(parentFontSize, 10) : 0;

		each(previewStyles.split(&#x27; &#x27;), function(name) {
			var value = dom.getStyle(previewElm, name, true);

			&#x2F;&#x2F; If background is transparent then check if the body has a background color we can use
			if (name == &#x27;background-color&#x27; &amp;&amp; &#x2F;transparent|rgba\s*\([^)]+,\s*0\)&#x2F;.test(value)) {
				value = dom.getStyle(ed.getBody(), name, true);

				&#x2F;&#x2F; Ignore white since it&#x27;s the default color, not the nicest fix
				if (dom.toHex(value).toLowerCase() == &#x27;#ffffff&#x27;) {
					return;
				}
			}

			&#x2F;&#x2F; Old IE won&#x27;t calculate the font size so we need to do that manually
			if (name == &#x27;font-size&#x27;) {
				if (&#x2F;em|%$&#x2F;.test(value)) {
					if (parentFontSize === 0) {
						return;
					}

					&#x2F;&#x2F; Convert font size from em&#x2F;% to px
					value = parseFloat(value, 10) &#x2F; (&#x2F;%$&#x2F;.test(value) ? 100 : 1);
					value = (value * parentFontSize) + &#x27;px&#x27;;
				}
			}

			previewCss += name + &#x27;:&#x27; + value + &#x27;;&#x27;;
		});

		dom.remove(previewElm);

		return previewCss;
	};

	&#x2F;&#x2F; Tell it to load theme specific language pack(s)
	tinymce.ThemeManager.requireLangPack(&#x27;advanced&#x27;);

	tinymce.create(&#x27;tinymce.themes.AdvancedTheme&#x27;, {
		sizes : [8, 10, 12, 14, 18, 24, 36],

		&#x2F;&#x2F; Control name lookup, format: title, command
		controls : {
			bold : [&#x27;bold_desc&#x27;, &#x27;Bold&#x27;],
			italic : [&#x27;italic_desc&#x27;, &#x27;Italic&#x27;],
			underline : [&#x27;underline_desc&#x27;, &#x27;Underline&#x27;],
			strikethrough : [&#x27;striketrough_desc&#x27;, &#x27;Strikethrough&#x27;],
			justifyleft : [&#x27;justifyleft_desc&#x27;, &#x27;JustifyLeft&#x27;],
			justifycenter : [&#x27;justifycenter_desc&#x27;, &#x27;JustifyCenter&#x27;],
			justifyright : [&#x27;justifyright_desc&#x27;, &#x27;JustifyRight&#x27;],
			justifyfull : [&#x27;justifyfull_desc&#x27;, &#x27;JustifyFull&#x27;],
			bullist : [&#x27;bullist_desc&#x27;, &#x27;InsertUnorderedList&#x27;],
			numlist : [&#x27;numlist_desc&#x27;, &#x27;InsertOrderedList&#x27;],
			outdent : [&#x27;outdent_desc&#x27;, &#x27;Outdent&#x27;],
			indent : [&#x27;indent_desc&#x27;, &#x27;Indent&#x27;],
			cut : [&#x27;cut_desc&#x27;, &#x27;Cut&#x27;],
			copy : [&#x27;copy_desc&#x27;, &#x27;Copy&#x27;],
			paste : [&#x27;paste_desc&#x27;, &#x27;Paste&#x27;],
			undo : [&#x27;undo_desc&#x27;, &#x27;Undo&#x27;],
			redo : [&#x27;redo_desc&#x27;, &#x27;Redo&#x27;],
			link : [&#x27;link_desc&#x27;, &#x27;mceLink&#x27;],
			unlink : [&#x27;unlink_desc&#x27;, &#x27;unlink&#x27;],
			image : [&#x27;image_desc&#x27;, &#x27;mceImage&#x27;],
			cleanup : [&#x27;cleanup_desc&#x27;, &#x27;mceCleanup&#x27;],
			help : [&#x27;help_desc&#x27;, &#x27;mceHelp&#x27;],
			code : [&#x27;code_desc&#x27;, &#x27;mceCodeEditor&#x27;],
			hr : [&#x27;hr_desc&#x27;, &#x27;InsertHorizontalRule&#x27;],
			removeformat : [&#x27;removeformat_desc&#x27;, &#x27;RemoveFormat&#x27;],
			sub : [&#x27;sub_desc&#x27;, &#x27;subscript&#x27;],
			sup : [&#x27;sup_desc&#x27;, &#x27;superscript&#x27;],
			forecolor : [&#x27;forecolor_desc&#x27;, &#x27;ForeColor&#x27;],
			forecolorpicker : [&#x27;forecolor_desc&#x27;, &#x27;mceForeColor&#x27;],
			backcolor : [&#x27;backcolor_desc&#x27;, &#x27;HiliteColor&#x27;],
			backcolorpicker : [&#x27;backcolor_desc&#x27;, &#x27;mceBackColor&#x27;],
			charmap : [&#x27;charmap_desc&#x27;, &#x27;mceCharMap&#x27;],
			visualaid : [&#x27;visualaid_desc&#x27;, &#x27;mceToggleVisualAid&#x27;],
			anchor : [&#x27;anchor_desc&#x27;, &#x27;mceInsertAnchor&#x27;],
			newdocument : [&#x27;newdocument_desc&#x27;, &#x27;mceNewDocument&#x27;],
			blockquote : [&#x27;blockquote_desc&#x27;, &#x27;mceBlockQuote&#x27;]
		},

		stateControls : [&#x27;bold&#x27;, &#x27;italic&#x27;, &#x27;underline&#x27;, &#x27;strikethrough&#x27;, &#x27;bullist&#x27;, &#x27;numlist&#x27;, &#x27;justifyleft&#x27;, &#x27;justifycenter&#x27;, &#x27;justifyright&#x27;, &#x27;justifyfull&#x27;, &#x27;sub&#x27;, &#x27;sup&#x27;, &#x27;blockquote&#x27;],

		init : function(ed, url) {
			var t = this, s, v, o;

			t.editor = ed;
			t.url = url;
			t.onResolveName = new tinymce.util.Dispatcher(this);
			s = ed.settings;

			ed.forcedHighContrastMode = ed.settings.detect_highcontrast &amp;&amp; t._isHighContrast();
			ed.settings.skin = ed.forcedHighContrastMode ? &#x27;highcontrast&#x27; : ed.settings.skin;

			&#x2F;&#x2F; Setup default buttons
			if (!s.theme_advanced_buttons1) {
				s = extend({
					theme_advanced_buttons1 : &quot;bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect&quot;,
					theme_advanced_buttons2 : &quot;bullist,numlist,|,outdent,indent,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code&quot;,
					theme_advanced_buttons3 : &quot;hr,removeformat,visualaid,|,sub,sup,|,charmap&quot;
				}, s);
			}

			&#x2F;&#x2F; Default settings
			t.settings = s = extend({
				theme_advanced_path : true,
				theme_advanced_toolbar_location : &#x27;top&#x27;,
				theme_advanced_blockformats : &quot;p,address,pre,h1,h2,h3,h4,h5,h6&quot;,
				theme_advanced_toolbar_align : &quot;left&quot;,
				theme_advanced_statusbar_location : &quot;bottom&quot;,
				theme_advanced_fonts : &quot;Andale Mono=andale mono,times;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier;Georgia=georgia,palatino;Helvetica=helvetica;Impact=impact,chicago;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco;Times New Roman=times new roman,times;Trebuchet MS=trebuchet ms,geneva;Verdana=verdana,geneva;Webdings=webdings;Wingdings=wingdings,zapf dingbats&quot;,
				theme_advanced_more_colors : 1,
				theme_advanced_row_height : 23,
				theme_advanced_resize_horizontal : 1,
				theme_advanced_resizing_use_cookie : 1,
				theme_advanced_font_sizes : &quot;1,2,3,4,5,6,7&quot;,
				theme_advanced_font_selector : &quot;span&quot;,
				theme_advanced_show_current_color: 0,
				readonly : ed.settings.readonly
			}, s);

			&#x2F;&#x2F; Setup default font_size_style_values
			if (!s.font_size_style_values)
				s.font_size_style_values = &quot;8pt,10pt,12pt,14pt,18pt,24pt,36pt&quot;;

			if (tinymce.is(s.theme_advanced_font_sizes, &#x27;string&#x27;)) {
				s.font_size_style_values = tinymce.explode(s.font_size_style_values);
				s.font_size_classes = tinymce.explode(s.font_size_classes || &#x27;&#x27;);

				&#x2F;&#x2F; Parse string value
				o = {};
				ed.settings.theme_advanced_font_sizes = s.theme_advanced_font_sizes;
				each(ed.getParam(&#x27;theme_advanced_font_sizes&#x27;, &#x27;&#x27;, &#x27;hash&#x27;), function(v, k) {
					var cl;

					if (k == v &amp;&amp; v &gt;= 1 &amp;&amp; v &lt;= 7) {
						k = v + &#x27; (&#x27; + t.sizes[v - 1] + &#x27;pt)&#x27;;
						cl = s.font_size_classes[v - 1];
						v = s.font_size_style_values[v - 1] || (t.sizes[v - 1] + &#x27;pt&#x27;);
					}

					if (&#x2F;^\s*\.&#x2F;.test(v))
						cl = v.replace(&#x2F;\.&#x2F;g, &#x27;&#x27;);

					o[k] = cl ? {&#x27;class&#x27; : cl} : {fontSize : v};
				});

				s.theme_advanced_font_sizes = o;
			}

			if ((v = s.theme_advanced_path_location) &amp;&amp; v != &#x27;none&#x27;)
				s.theme_advanced_statusbar_location = s.theme_advanced_path_location;

			if (s.theme_advanced_statusbar_location == &#x27;none&#x27;)
				s.theme_advanced_statusbar_location = 0;

			if (ed.settings.content_css !== false)
				ed.contentCSS.push(ed.baseURI.toAbsolute(url + &quot;&#x2F;skins&#x2F;&quot; + ed.settings.skin + &quot;&#x2F;content.css&quot;));

			&#x2F;&#x2F; Init editor
			ed.onInit.add(function() {
				if (!ed.settings.readonly) {
					ed.onNodeChange.add(t._nodeChanged, t);
					ed.onKeyUp.add(t._updateUndoStatus, t);
					ed.onMouseUp.add(t._updateUndoStatus, t);
					ed.dom.bind(ed.dom.getRoot(), &#x27;dragend&#x27;, function() {
						t._updateUndoStatus(ed);
					});
				}
			});

			ed.onSetProgressState.add(function(ed, b, ti) {
				var co, id = ed.id, tb;

				if (b) {
					t.progressTimer = setTimeout(function() {
						co = ed.getContainer();
						co = co.insertBefore(DOM.create(&#x27;DIV&#x27;, {style : &#x27;position:relative&#x27;}), co.firstChild);
						tb = DOM.get(ed.id + &#x27;_tbl&#x27;);

						DOM.add(co, &#x27;div&#x27;, {id : id + &#x27;_blocker&#x27;, &#x27;class&#x27; : &#x27;mceBlocker&#x27;, style : {width : tb.clientWidth + 2, height : tb.clientHeight + 2}});
						DOM.add(co, &#x27;div&#x27;, {id : id + &#x27;_progress&#x27;, &#x27;class&#x27; : &#x27;mceProgress&#x27;, style : {left : tb.clientWidth &#x2F; 2, top : tb.clientHeight &#x2F; 2}});
					}, ti || 0);
				} else {
					DOM.remove(id + &#x27;_blocker&#x27;);
					DOM.remove(id + &#x27;_progress&#x27;);
					clearTimeout(t.progressTimer);
				}
			});

			DOM.loadCSS(s.editor_css ? ed.documentBaseURI.toAbsolute(s.editor_css) : url + &quot;&#x2F;skins&#x2F;&quot; + ed.settings.skin + &quot;&#x2F;ui.css&quot;);

			if (s.skin_variant)
				DOM.loadCSS(url + &quot;&#x2F;skins&#x2F;&quot; + ed.settings.skin + &quot;&#x2F;ui_&quot; + s.skin_variant + &quot;.css&quot;);
		},

		_isHighContrast : function() {
			var actualColor, div = DOM.add(DOM.getRoot(), &#x27;div&#x27;, {&#x27;style&#x27;: &#x27;background-color: rgb(171,239,86);&#x27;});

			actualColor = (DOM.getStyle(div, &#x27;background-color&#x27;, true) + &#x27;&#x27;).toLowerCase().replace(&#x2F; &#x2F;g, &#x27;&#x27;);
			DOM.remove(div);

			return actualColor != &#x27;rgb(171,239,86)&#x27; &amp;&amp; actualColor != &#x27;#abef56&#x27;;
		},

		createControl : function(n, cf) {
			var cd, c;

			if (c = cf.createControl(n))
				return c;

			switch (n) {
				case &quot;styleselect&quot;:
					return this._createStyleSelect();

				case &quot;formatselect&quot;:
					return this._createBlockFormats();

				case &quot;fontselect&quot;:
					return this._createFontSelect();

				case &quot;fontsizeselect&quot;:
					return this._createFontSizeSelect();

				case &quot;forecolor&quot;:
					return this._createForeColorMenu();

				case &quot;backcolor&quot;:
					return this._createBackColorMenu();
			}

			if ((cd = this.controls[n]))
				return cf.createButton(n, {title : &quot;advanced.&quot; + cd[0], cmd : cd[1], ui : cd[2], value : cd[3]});
		},

		execCommand : function(cmd, ui, val) {
			var f = this[&#x27;_&#x27; + cmd];

			if (f) {
				f.call(this, ui, val);
				return true;
			}

			return false;
		},

		_importClasses : function(e) {
			var ed = this.editor, ctrl = ed.controlManager.get(&#x27;styleselect&#x27;);

			if (ctrl.getLength() == 0) {
				each(ed.dom.getClasses(), function(o, idx) {
					var name = &#x27;style_&#x27; + idx, fmt;

					fmt = {
						inline : &#x27;span&#x27;,
						attributes : {&#x27;class&#x27; : o[&#x27;class&#x27;]},
						selector : &#x27;*&#x27;
					};

					ed.formatter.register(name, fmt);

					ctrl.add(o[&#x27;class&#x27;], name, {
						style: function() {
							return getPreviewCss(ed, fmt);
						}
					});
				});
			}
		},

		_createStyleSelect : function(n) {
			var t = this, ed = t.editor, ctrlMan = ed.controlManager, ctrl;

			&#x2F;&#x2F; Setup style select box
			ctrl = ctrlMan.createListBox(&#x27;styleselect&#x27;, {
				title : &#x27;advanced.style_select&#x27;,
				onselect : function(name) {
					var matches, formatNames = [], removedFormat;

					each(ctrl.items, function(item) {
						formatNames.push(item.value);
					});

					ed.focus();
					ed.undoManager.add();

					&#x2F;&#x2F; Toggle off the current format(s)
					matches = ed.formatter.matchAll(formatNames);
					tinymce.each(matches, function(match) {
						if (!name || match == name) {
							if (match)
								ed.formatter.remove(match);

							removedFormat = true;
						}
					});

					if (!removedFormat)
						ed.formatter.apply(name);

					ed.undoManager.add();
					ed.nodeChanged();

					return false; &#x2F;&#x2F; No auto select
				}
			});

			&#x2F;&#x2F; Handle specified format
			ed.onPreInit.add(function() {
				var counter = 0, formats = ed.getParam(&#x27;style_formats&#x27;);

				if (formats) {
					each(formats, function(fmt) {
						var name, keys = 0;

						each(fmt, function() {keys++;});

						if (keys &gt; 1) {
							name = fmt.name = fmt.name || &#x27;style_&#x27; + (counter++);
							ed.formatter.register(name, fmt);
							ctrl.add(fmt.title, name, {
								style: function() {
									return getPreviewCss(ed, fmt);
								}
							});
						} else
							ctrl.add(fmt.title);
					});
				} else {
					each(ed.getParam(&#x27;theme_advanced_styles&#x27;, &#x27;&#x27;, &#x27;hash&#x27;), function(val, key) {
						var name, fmt;

						if (val) {
							name = &#x27;style_&#x27; + (counter++);
							fmt = {
								inline : &#x27;span&#x27;,
								classes : val,
								selector : &#x27;*&#x27;
							};

							ed.formatter.register(name, fmt);
							ctrl.add(t.editor.translate(key), name, {
								style: function() {
									return getPreviewCss(ed, fmt);
								}
							});
						}
					});
				}
			});

			&#x2F;&#x2F; Auto import classes if the ctrl box is empty
			if (ctrl.getLength() == 0) {
				ctrl.onPostRender.add(function(ed, n) {
					if (!ctrl.NativeListBox) {
						Event.add(n.id + &#x27;_text&#x27;, &#x27;focus&#x27;, t._importClasses, t);
						Event.add(n.id + &#x27;_text&#x27;, &#x27;mousedown&#x27;, t._importClasses, t);
						Event.add(n.id + &#x27;_open&#x27;, &#x27;focus&#x27;, t._importClasses, t);
						Event.add(n.id + &#x27;_open&#x27;, &#x27;mousedown&#x27;, t._importClasses, t);
					} else
						Event.add(n.id, &#x27;focus&#x27;, t._importClasses, t);
				});
			}

			return ctrl;
		},

		_createFontSelect : function() {
			var c, t = this, ed = t.editor;

			c = ed.controlManager.createListBox(&#x27;fontselect&#x27;, {
				title : &#x27;advanced.fontdefault&#x27;,
				onselect : function(v) {
					var cur = c.items[c.selectedIndex];

					if (!v &amp;&amp; cur) {
						ed.execCommand(&#x27;FontName&#x27;, false, cur.value);
						return;
					}

					ed.execCommand(&#x27;FontName&#x27;, false, v);

					&#x2F;&#x2F; Fake selection, execCommand will fire a nodeChange and update the selection
					c.select(function(sv) {
						return v == sv;
					});

					if (cur &amp;&amp; cur.value == v) {
						c.select(null);
					}

					return false; &#x2F;&#x2F; No auto select
				}
			});

			if (c) {
				each(ed.getParam(&#x27;theme_advanced_fonts&#x27;, t.settings.theme_advanced_fonts, &#x27;hash&#x27;), function(v, k) {
					c.add(ed.translate(k), v, {style : v.indexOf(&#x27;dings&#x27;) == -1 ? &#x27;font-family:&#x27; + v : &#x27;&#x27;});
				});
			}

			return c;
		},

		_createFontSizeSelect : function() {
			var t = this, ed = t.editor, c, i = 0, cl = [];

			c = ed.controlManager.createListBox(&#x27;fontsizeselect&#x27;, {title : &#x27;advanced.font_size&#x27;, onselect : function(v) {
				var cur = c.items[c.selectedIndex];

				if (!v &amp;&amp; cur) {
					cur = cur.value;

					if (cur[&#x27;class&#x27;]) {
						ed.formatter.toggle(&#x27;fontsize_class&#x27;, {value : cur[&#x27;class&#x27;]});
						ed.undoManager.add();
						ed.nodeChanged();
					} else {
						ed.execCommand(&#x27;FontSize&#x27;, false, cur.fontSize);
					}

					return;
				}

				if (v[&#x27;class&#x27;]) {
					ed.focus();
					ed.undoManager.add();
					ed.formatter.toggle(&#x27;fontsize_class&#x27;, {value : v[&#x27;class&#x27;]});
					ed.undoManager.add();
					ed.nodeChanged();
				} else
					ed.execCommand(&#x27;FontSize&#x27;, false, v.fontSize);

				&#x2F;&#x2F; Fake selection, execCommand will fire a nodeChange and update the selection
				c.select(function(sv) {
					return v == sv;
				});

				if (cur &amp;&amp; (cur.value.fontSize == v.fontSize || cur.value[&#x27;class&#x27;] &amp;&amp; cur.value[&#x27;class&#x27;] == v[&#x27;class&#x27;])) {
					c.select(null);
				}

				return false; &#x2F;&#x2F; No auto select
			}});

			if (c) {
				each(t.settings.theme_advanced_font_sizes, function(v, k) {
					var fz = v.fontSize;

					if (fz &gt;= 1 &amp;&amp; fz &lt;= 7)
						fz = t.sizes[parseInt(fz) - 1] + &#x27;pt&#x27;;

					c.add(k, v, {&#x27;style&#x27; : &#x27;font-size:&#x27; + fz, &#x27;class&#x27; : &#x27;mceFontSize&#x27; + (i++) + (&#x27; &#x27; + (v[&#x27;class&#x27;] || &#x27;&#x27;))});
				});
			}

			return c;
		},

		_createBlockFormats : function() {
			var c, fmts = {
				p : &#x27;advanced.paragraph&#x27;,
				address : &#x27;advanced.address&#x27;,
				pre : &#x27;advanced.pre&#x27;,
				h1 : &#x27;advanced.h1&#x27;,
				h2 : &#x27;advanced.h2&#x27;,
				h3 : &#x27;advanced.h3&#x27;,
				h4 : &#x27;advanced.h4&#x27;,
				h5 : &#x27;advanced.h5&#x27;,
				h6 : &#x27;advanced.h6&#x27;,
				div : &#x27;advanced.div&#x27;,
				blockquote : &#x27;advanced.blockquote&#x27;,
				code : &#x27;advanced.code&#x27;,
				dt : &#x27;advanced.dt&#x27;,
				dd : &#x27;advanced.dd&#x27;,
				samp : &#x27;advanced.samp&#x27;
			}, t = this;

			c = t.editor.controlManager.createListBox(&#x27;formatselect&#x27;, {title : &#x27;advanced.block&#x27;, onselect : function(v) {
				t.editor.execCommand(&#x27;FormatBlock&#x27;, false, v);
				return false;
			}});

			if (c) {
				each(t.editor.getParam(&#x27;theme_advanced_blockformats&#x27;, t.settings.theme_advanced_blockformats, &#x27;hash&#x27;), function(v, k) {
					c.add(t.editor.translate(k != v ? k : fmts[v]), v, {&#x27;class&#x27; : &#x27;mce_formatPreview mce_&#x27; + v, style: function() {
						return getPreviewCss(t.editor, {block: v});
					}});
				});
			}

			return c;
		},

		_createForeColorMenu : function() {
			var c, t = this, s = t.settings, o = {}, v;

			if (s.theme_advanced_more_colors) {
				o.more_colors_func = function() {
					t._mceColorPicker(0, {
						color : c.value,
						func : function(co) {
							c.setColor(co);
						}
					});
				};
			}

			if (v = s.theme_advanced_text_colors)
				o.colors = v;

			if (s.theme_advanced_default_foreground_color)
				o.default_color = s.theme_advanced_default_foreground_color;

			o.title = &#x27;advanced.forecolor_desc&#x27;;
			o.cmd = &#x27;ForeColor&#x27;;
			o.scope = this;

			c = t.editor.controlManager.createColorSplitButton(&#x27;forecolor&#x27;, o);

			return c;
		},

		_createBackColorMenu : function() {
			var c, t = this, s = t.settings, o = {}, v;

			if (s.theme_advanced_more_colors) {
				o.more_colors_func = function() {
					t._mceColorPicker(0, {
						color : c.value,
						func : function(co) {
							c.setColor(co);
						}
					});
				};
			}

			if (v = s.theme_advanced_background_colors)
				o.colors = v;

			if (s.theme_advanced_default_background_color)
				o.default_color = s.theme_advanced_default_background_color;

			o.title = &#x27;advanced.backcolor_desc&#x27;;
			o.cmd = &#x27;HiliteColor&#x27;;
			o.scope = this;

			c = t.editor.controlManager.createColorSplitButton(&#x27;backcolor&#x27;, o);

			return c;
		},

		renderUI : function(o) {
			var n, ic, tb, t = this, ed = t.editor, s = t.settings, sc, p, nl;

			if (ed.settings) {
				ed.settings.aria_label = s.aria_label + ed.getLang(&#x27;advanced.help_shortcut&#x27;);
			}

			&#x2F;&#x2F; TODO: ACC Should have an aria-describedby attribute which is user-configurable to describe what this field is actually for.
			&#x2F;&#x2F; Maybe actually inherit it from the original textara?
			n = p = DOM.create(&#x27;span&#x27;, {role : &#x27;application&#x27;, &#x27;aria-labelledby&#x27; : ed.id + &#x27;_voice&#x27;, id : ed.id + &#x27;_parent&#x27;, &#x27;class&#x27; : &#x27;mceEditor &#x27; + ed.settings.skin + &#x27;Skin&#x27; + (s.skin_variant ? &#x27; &#x27; + ed.settings.skin + &#x27;Skin&#x27; + t._ufirst(s.skin_variant) : &#x27;&#x27;) + (ed.settings.directionality == &quot;rtl&quot; ? &#x27; mceRtl&#x27; : &#x27;&#x27;)});
			DOM.add(n, &#x27;span&#x27;, {&#x27;class&#x27;: &#x27;mceVoiceLabel&#x27;, &#x27;style&#x27;: &#x27;display:none;&#x27;, id: ed.id + &#x27;_voice&#x27;}, s.aria_label);

			if (!DOM.boxModel)
				n = DOM.add(n, &#x27;div&#x27;, {&#x27;class&#x27; : &#x27;mceOldBoxModel&#x27;});

			n = sc = DOM.add(n, &#x27;table&#x27;, {role : &quot;presentation&quot;, id : ed.id + &#x27;_tbl&#x27;, &#x27;class&#x27; : &#x27;mceLayout&#x27;, cellSpacing : 0, cellPadding : 0});
			n = tb = DOM.add(n, &#x27;tbody&#x27;);

			switch ((s.theme_advanced_layout_manager || &#x27;&#x27;).toLowerCase()) {
				case &quot;rowlayout&quot;:
					ic = t._rowLayout(s, tb, o);
					break;

				case &quot;customlayout&quot;:
					ic = ed.execCallback(&quot;theme_advanced_custom_layout&quot;, s, tb, o, p);
					break;

				default:
					ic = t._simpleLayout(s, tb, o, p);
			}

			n = o.targetNode;

			&#x2F;&#x2F; Add classes to first and last TRs
			nl = sc.rows;
			DOM.addClass(nl[0], &#x27;mceFirst&#x27;);
			DOM.addClass(nl[nl.length - 1], &#x27;mceLast&#x27;);

			&#x2F;&#x2F; Add classes to first and last TDs
			each(DOM.select(&#x27;tr&#x27;, tb), function(n) {
				DOM.addClass(n.firstChild, &#x27;mceFirst&#x27;);
				DOM.addClass(n.childNodes[n.childNodes.length - 1], &#x27;mceLast&#x27;);
			});

			if (DOM.get(s.theme_advanced_toolbar_container))
				DOM.get(s.theme_advanced_toolbar_container).appendChild(p);
			else
				DOM.insertAfter(p, n);

			Event.add(ed.id + &#x27;_path_row&#x27;, &#x27;click&#x27;, function(e) {
				e = e.target;

				if (e.nodeName == &#x27;A&#x27;) {
					t._sel(e.className.replace(&#x2F;^.*mcePath_([0-9]+).*$&#x2F;, &#x27;$1&#x27;));
					return false;
				}
			});
&#x2F;*
			if (DOM.get(ed.id + &#x27;_path_row&#x27;)) {
				Event.add(ed.id + &#x27;_tbl&#x27;, &#x27;mouseover&#x27;, function(e) {
					var re;

					e = e.target;

					if (e.nodeName == &#x27;SPAN&#x27; &amp;&amp; DOM.hasClass(e.parentNode, &#x27;mceButton&#x27;)) {
						re = DOM.get(ed.id + &#x27;_path_row&#x27;);
						t.lastPath = re.innerHTML;
						DOM.setHTML(re, e.parentNode.title);
					}
				});

				Event.add(ed.id + &#x27;_tbl&#x27;, &#x27;mouseout&#x27;, function(e) {
					if (t.lastPath) {
						DOM.setHTML(ed.id + &#x27;_path_row&#x27;, t.lastPath);
						t.lastPath = 0;
					}
				});
			}
*&#x2F;

			if (!ed.getParam(&#x27;accessibility_focus&#x27;))
				Event.add(DOM.add(p, &#x27;a&#x27;, {href : &#x27;#&#x27;}, &#x27;&lt;!-- IE --&gt;&#x27;), &#x27;focus&#x27;, function() {tinyMCE.get(ed.id).focus();});

			if (s.theme_advanced_toolbar_location == &#x27;external&#x27;)
				o.deltaHeight = 0;

			t.deltaHeight = o.deltaHeight;
			o.targetNode = null;

			ed.onKeyDown.add(function(ed, evt) {
				var DOM_VK_F10 = 121, DOM_VK_F11 = 122;

				if (evt.altKey) {
		 			if (evt.keyCode === DOM_VK_F10) {
						&#x2F;&#x2F; Make sure focus is given to toolbar in Safari.
						&#x2F;&#x2F; We can&#x27;t do this in IE as it prevents giving focus to toolbar when editor is in a frame
						if (tinymce.isWebKit) {
							window.focus();
						}
						t.toolbarGroup.focus();
						return Event.cancel(evt);
					} else if (evt.keyCode === DOM_VK_F11) {
						DOM.get(ed.id + &#x27;_path_row&#x27;).focus();
						return Event.cancel(evt);
					}
				}
			});

			&#x2F;&#x2F; alt+0 is the UK recommended shortcut for accessing the list of access controls.
			ed.addShortcut(&#x27;alt+0&#x27;, &#x27;&#x27;, &#x27;mceShortcuts&#x27;, t);

			return {
				iframeContainer : ic,
				editorContainer : ed.id + &#x27;_parent&#x27;,
				sizeContainer : sc,
				deltaHeight : o.deltaHeight
			};
		},

		getInfo : function() {
			return {
				longname : &#x27;Advanced theme&#x27;,
				author : &#x27;Moxiecode Systems AB&#x27;,
				authorurl : &#x27;http:&#x2F;&#x2F;tinymce.moxiecode.com&#x27;,
				version : tinymce.majorVersion + &quot;.&quot; + tinymce.minorVersion
			}
		},

		resizeBy : function(dw, dh) {
			var e = DOM.get(this.editor.id + &#x27;_ifr&#x27;);

			this.resizeTo(e.clientWidth + dw, e.clientHeight + dh);
		},

		resizeTo : function(w, h, store) {
			var ed = this.editor, s = this.settings, e = DOM.get(ed.id + &#x27;_tbl&#x27;), ifr = DOM.get(ed.id + &#x27;_ifr&#x27;);

			&#x2F;&#x2F; Boundery fix box
			w = Math.max(s.theme_advanced_resizing_min_width || 100, w);
			h = Math.max(s.theme_advanced_resizing_min_height || 100, h);
			w = Math.min(s.theme_advanced_resizing_max_width || 0xFFFF, w);
			h = Math.min(s.theme_advanced_resizing_max_height || 0xFFFF, h);

			&#x2F;&#x2F; Resize iframe and container
			DOM.setStyle(e, &#x27;height&#x27;, &#x27;&#x27;);
			DOM.setStyle(ifr, &#x27;height&#x27;, h);

			if (s.theme_advanced_resize_horizontal) {
				DOM.setStyle(e, &#x27;width&#x27;, &#x27;&#x27;);
				DOM.setStyle(ifr, &#x27;width&#x27;, w);

				&#x2F;&#x2F; Make sure that the size is never smaller than the over all ui
				if (w &lt; e.clientWidth) {
					w = e.clientWidth;
					DOM.setStyle(ifr, &#x27;width&#x27;, e.clientWidth);
				}
			}

			&#x2F;&#x2F; Store away the size
			if (store &amp;&amp; s.theme_advanced_resizing_use_cookie) {
				Cookie.setHash(&quot;TinyMCE_&quot; + ed.id + &quot;_size&quot;, {
					cw : w,
					ch : h
				});
			}
		},

		destroy : function() {
			var id = this.editor.id;

			Event.clear(id + &#x27;_resize&#x27;);
			Event.clear(id + &#x27;_path_row&#x27;);
			Event.clear(id + &#x27;_external_close&#x27;);
		},

		&#x2F;&#x2F; Internal functions

		_simpleLayout : function(s, tb, o, p) {
			var t = this, ed = t.editor, lo = s.theme_advanced_toolbar_location, sl = s.theme_advanced_statusbar_location, n, ic, etb, c;

			if (s.readonly) {
				n = DOM.add(tb, &#x27;tr&#x27;);
				n = ic = DOM.add(n, &#x27;td&#x27;, {&#x27;class&#x27; : &#x27;mceIframeContainer&#x27;});
				return ic;
			}

			&#x2F;&#x2F; Create toolbar container at top
			if (lo == &#x27;top&#x27;)
				t._addToolbars(tb, o);

			&#x2F;&#x2F; Create external toolbar
			if (lo == &#x27;external&#x27;) {
				n = c = DOM.create(&#x27;div&#x27;, {style : &#x27;position:relative&#x27;});
				n = DOM.add(n, &#x27;div&#x27;, {id : ed.id + &#x27;_external&#x27;, &#x27;class&#x27; : &#x27;mceExternalToolbar&#x27;});
				DOM.add(n, &#x27;a&#x27;, {id : ed.id + &#x27;_external_close&#x27;, href : &#x27;javascript:;&#x27;, &#x27;class&#x27; : &#x27;mceExternalClose&#x27;});
				n = DOM.add(n, &#x27;table&#x27;, {id : ed.id + &#x27;_tblext&#x27;, cellSpacing : 0, cellPadding : 0});
				etb = DOM.add(n, &#x27;tbody&#x27;);

				if (p.firstChild.className == &#x27;mceOldBoxModel&#x27;)
					p.firstChild.appendChild(c);
				else
					p.insertBefore(c, p.firstChild);

				t._addToolbars(etb, o);

				ed.onMouseUp.add(function() {
					var e = DOM.get(ed.id + &#x27;_external&#x27;);
					DOM.show(e);

					DOM.hide(lastExtID);

					var f = Event.add(ed.id + &#x27;_external_close&#x27;, &#x27;click&#x27;, function() {
						DOM.hide(ed.id + &#x27;_external&#x27;);
						Event.remove(ed.id + &#x27;_external_close&#x27;, &#x27;click&#x27;, f);
						return false;
					});

					DOM.show(e);
					DOM.setStyle(e, &#x27;top&#x27;, 0 - DOM.getRect(ed.id + &#x27;_tblext&#x27;).h - 1);

					&#x2F;&#x2F; Fixes IE rendering bug
					DOM.hide(e);
					DOM.show(e);
					e.style.filter = &#x27;&#x27;;

					lastExtID = ed.id + &#x27;_external&#x27;;

					e = null;
				});
			}

			if (sl == &#x27;top&#x27;)
				t._addStatusBar(tb, o);

			&#x2F;&#x2F; Create iframe container
			if (!s.theme_advanced_toolbar_container) {
				n = DOM.add(tb, &#x27;tr&#x27;);
				n = ic = DOM.add(n, &#x27;td&#x27;, {&#x27;class&#x27; : &#x27;mceIframeContainer&#x27;});
			}

			&#x2F;&#x2F; Create toolbar container at bottom
			if (lo == &#x27;bottom&#x27;)
				t._addToolbars(tb, o);

			if (sl == &#x27;bottom&#x27;)
				t._addStatusBar(tb, o);

			return ic;
		},

		_rowLayout : function(s, tb, o) {
			var t = this, ed = t.editor, dc, da, cf = ed.controlManager, n, ic, to, a;

			dc = s.theme_advanced_containers_default_class || &#x27;&#x27;;
			da = s.theme_advanced_containers_default_align || &#x27;center&#x27;;

			each(explode(s.theme_advanced_containers || &#x27;&#x27;), function(c, i) {
				var v = s[&#x27;theme_advanced_container_&#x27; + c] || &#x27;&#x27;;

				switch (c.toLowerCase()) {
					case &#x27;mceeditor&#x27;:
						n = DOM.add(tb, &#x27;tr&#x27;);
						n = ic = DOM.add(n, &#x27;td&#x27;, {&#x27;class&#x27; : &#x27;mceIframeContainer&#x27;});
						break;

					case &#x27;mceelementpath&#x27;:
						t._addStatusBar(tb, o);
						break;

					default:
						a = (s[&#x27;theme_advanced_container_&#x27; + c + &#x27;_align&#x27;] || da).toLowerCase();
						a = &#x27;mce&#x27; + t._ufirst(a);

						n = DOM.add(DOM.add(tb, &#x27;tr&#x27;), &#x27;td&#x27;, {
							&#x27;class&#x27; : &#x27;mceToolbar &#x27; + (s[&#x27;theme_advanced_container_&#x27; + c + &#x27;_class&#x27;] || dc) + &#x27; &#x27; + a || da
						});

						to = cf.createToolbar(&quot;toolbar&quot; + i);
						t._addControls(v, to);
						DOM.setHTML(n, to.renderHTML());
						o.deltaHeight -= s.theme_advanced_row_height;
				}
			});

			return ic;
		},

		_addControls : function(v, tb) {
			var t = this, s = t.settings, di, cf = t.editor.controlManager;

			if (s.theme_advanced_disable &amp;&amp; !t._disabled) {
				di = {};

				each(explode(s.theme_advanced_disable), function(v) {
					di[v] = 1;
				});

				t._disabled = di;
			} else
				di = t._disabled;

			each(explode(v), function(n) {
				var c;

				if (di &amp;&amp; di[n])
					return;

				&#x2F;&#x2F; Compatiblity with 2.x
				if (n == &#x27;tablecontrols&#x27;) {
					each([&quot;table&quot;,&quot;|&quot;,&quot;row_props&quot;,&quot;cell_props&quot;,&quot;|&quot;,&quot;row_before&quot;,&quot;row_after&quot;,&quot;delete_row&quot;,&quot;|&quot;,&quot;col_before&quot;,&quot;col_after&quot;,&quot;delete_col&quot;,&quot;|&quot;,&quot;split_cells&quot;,&quot;merge_cells&quot;], function(n) {
						n = t.createControl(n, cf);

						if (n)
							tb.add(n);
					});

					return;
				}

				c = t.createControl(n, cf);

				if (c)
					tb.add(c);
			});
		},

		_addToolbars : function(c, o) {
			var t = this, i, tb, ed = t.editor, s = t.settings, v, cf = ed.controlManager, di, n, h = [], a, toolbarGroup, toolbarsExist = false;

			toolbarGroup = cf.createToolbarGroup(&#x27;toolbargroup&#x27;, {
				&#x27;name&#x27;: ed.getLang(&#x27;advanced.toolbar&#x27;),
				&#x27;tab_focus_toolbar&#x27;:ed.getParam(&#x27;theme_advanced_tab_focus_toolbar&#x27;)
			});

			t.toolbarGroup = toolbarGroup;

			a = s.theme_advanced_toolbar_align.toLowerCase();
			a = &#x27;mce&#x27; + t._ufirst(a);

			n = DOM.add(DOM.add(c, &#x27;tr&#x27;, {role: &#x27;toolbar&#x27;}), &#x27;td&#x27;, {&#x27;class&#x27; : &#x27;mceToolbar &#x27; + a, &quot;role&quot;:&quot;toolbar&quot;});

			&#x2F;&#x2F; Create toolbar and add the controls
			for (i=1; (v = s[&#x27;theme_advanced_buttons&#x27; + i]); i++) {
				toolbarsExist = true;
				tb = cf.createToolbar(&quot;toolbar&quot; + i, {&#x27;class&#x27; : &#x27;mceToolbarRow&#x27; + i});

				if (s[&#x27;theme_advanced_buttons&#x27; + i + &#x27;_add&#x27;])
					v += &#x27;,&#x27; + s[&#x27;theme_advanced_buttons&#x27; + i + &#x27;_add&#x27;];

				if (s[&#x27;theme_advanced_buttons&#x27; + i + &#x27;_add_before&#x27;])
					v = s[&#x27;theme_advanced_buttons&#x27; + i + &#x27;_add_before&#x27;] + &#x27;,&#x27; + v;

				t._addControls(v, tb);
				toolbarGroup.add(tb);

				o.deltaHeight -= s.theme_advanced_row_height;
			}
			&#x2F;&#x2F; Handle case when there are no toolbar buttons and ensure editor height is adjusted accordingly
			if (!toolbarsExist)
				o.deltaHeight -= s.theme_advanced_row_height;
			h.push(toolbarGroup.renderHTML());
			h.push(DOM.createHTML(&#x27;a&#x27;, {href : &#x27;#&#x27;, accesskey : &#x27;z&#x27;, title : ed.getLang(&quot;advanced.toolbar_focus&quot;), onfocus : &#x27;tinyMCE.getInstanceById(\&#x27;&#x27; + ed.id + &#x27;\&#x27;).focus();&#x27;}, &#x27;&lt;!-- IE --&gt;&#x27;));
			DOM.setHTML(n, h.join(&#x27;&#x27;));
		},

		_addStatusBar : function(tb, o) {
			var n, t = this, ed = t.editor, s = t.settings, r, mf, me, td;

			n = DOM.add(tb, &#x27;tr&#x27;);
			n = td = DOM.add(n, &#x27;td&#x27;, {&#x27;class&#x27; : &#x27;mceStatusbar&#x27;});
			n = DOM.add(n, &#x27;div&#x27;, {id : ed.id + &#x27;_path_row&#x27;, &#x27;role&#x27;: &#x27;group&#x27;, &#x27;aria-labelledby&#x27;: ed.id + &#x27;_path_voice&#x27;});
			if (s.theme_advanced_path) {
				DOM.add(n, &#x27;span&#x27;, {id: ed.id + &#x27;_path_voice&#x27;}, ed.translate(&#x27;advanced.path&#x27;));
				DOM.add(n, &#x27;span&#x27;, {}, &#x27;: &#x27;);
			} else {
				DOM.add(n, &#x27;span&#x27;, {}, &#x27;&amp;#160;&#x27;);
			}


			if (s.theme_advanced_resizing) {
				DOM.add(td, &#x27;a&#x27;, {id : ed.id + &#x27;_resize&#x27;, href : &#x27;javascript:;&#x27;, onclick : &quot;return false;&quot;, &#x27;class&#x27; : &#x27;mceResize&#x27;, tabIndex:&quot;-1&quot;});

				if (s.theme_advanced_resizing_use_cookie) {
					ed.onPostRender.add(function() {
						var o = Cookie.getHash(&quot;TinyMCE_&quot; + ed.id + &quot;_size&quot;), c = DOM.get(ed.id + &#x27;_tbl&#x27;);

						if (!o)
							return;

						t.resizeTo(o.cw, o.ch);
					});
				}

				ed.onPostRender.add(function() {
					Event.add(ed.id + &#x27;_resize&#x27;, &#x27;click&#x27;, function(e) {
						e.preventDefault();
					});

					Event.add(ed.id + &#x27;_resize&#x27;, &#x27;mousedown&#x27;, function(e) {
						var mouseMoveHandler1, mouseMoveHandler2,
							mouseUpHandler1, mouseUpHandler2,
							startX, startY, startWidth, startHeight, width, height, ifrElm;

						function resizeOnMove(e) {
							e.preventDefault();

							width = startWidth + (e.screenX - startX);
							height = startHeight + (e.screenY - startY);

							t.resizeTo(width, height);
						};

						function endResize(e) {
							&#x2F;&#x2F; Stop listening
							Event.remove(DOM.doc, &#x27;mousemove&#x27;, mouseMoveHandler1);
							Event.remove(ed.getDoc(), &#x27;mousemove&#x27;, mouseMoveHandler2);
							Event.remove(DOM.doc, &#x27;mouseup&#x27;, mouseUpHandler1);
							Event.remove(ed.getDoc(), &#x27;mouseup&#x27;, mouseUpHandler2);

							width = startWidth + (e.screenX - startX);
							height = startHeight + (e.screenY - startY);
							t.resizeTo(width, height, true);

							ed.nodeChanged();
						};

						e.preventDefault();

						&#x2F;&#x2F; Get the current rect size
						startX = e.screenX;
						startY = e.screenY;
						ifrElm = DOM.get(t.editor.id + &#x27;_ifr&#x27;);
						startWidth = width = ifrElm.clientWidth;
						startHeight = height = ifrElm.clientHeight;

						&#x2F;&#x2F; Register envent handlers
						mouseMoveHandler1 = Event.add(DOM.doc, &#x27;mousemove&#x27;, resizeOnMove);
						mouseMoveHandler2 = Event.add(ed.getDoc(), &#x27;mousemove&#x27;, resizeOnMove);
						mouseUpHandler1 = Event.add(DOM.doc, &#x27;mouseup&#x27;, endResize);
						mouseUpHandler2 = Event.add(ed.getDoc(), &#x27;mouseup&#x27;, endResize);
					});
				});
			}

			o.deltaHeight -= 21;
			n = tb = null;
		},

		_updateUndoStatus : function(ed) {
			var cm = ed.controlManager, um = ed.undoManager;

			cm.setDisabled(&#x27;undo&#x27;, !um.hasUndo() &amp;&amp; !um.typing);
			cm.setDisabled(&#x27;redo&#x27;, !um.hasRedo());
		},

		_nodeChanged : function(ed, cm, n, co, ob) {
			var t = this, p, de = 0, v, c, s = t.settings, cl, fz, fn, fc, bc, formatNames, matches;

			tinymce.each(t.stateControls, function(c) {
				cm.setActive(c, ed.queryCommandState(t.controls[c][1]));
			});

			function getParent(name) {
				var i, parents = ob.parents, func = name;

				if (typeof(name) == &#x27;string&#x27;) {
					func = function(node) {
						return node.nodeName == name;
					};
				}

				for (i = 0; i &lt; parents.length; i++) {
					if (func(parents[i]))
						return parents[i];
				}
			};

			cm.setActive(&#x27;visualaid&#x27;, ed.hasVisual);
			t._updateUndoStatus(ed);
			cm.setDisabled(&#x27;outdent&#x27;, !ed.queryCommandState(&#x27;Outdent&#x27;));

			p = getParent(&#x27;A&#x27;);
			if (c = cm.get(&#x27;link&#x27;)) {
				c.setDisabled((!p &amp;&amp; co) || (p &amp;&amp; !p.href));
				c.setActive(!!p &amp;&amp; (!p.name &amp;&amp; !p.id));
			}

			if (c = cm.get(&#x27;unlink&#x27;)) {
				c.setDisabled(!p &amp;&amp; co);
				c.setActive(!!p &amp;&amp; !p.name &amp;&amp; !p.id);
			}

			if (c = cm.get(&#x27;anchor&#x27;)) {
				c.setActive(!co &amp;&amp; !!p &amp;&amp; (p.name || (p.id &amp;&amp; !p.href)));
			}

			p = getParent(&#x27;IMG&#x27;);
			if (c = cm.get(&#x27;image&#x27;))
				c.setActive(!co &amp;&amp; !!p &amp;&amp; n.className.indexOf(&#x27;mceItem&#x27;) == -1);

			if (c = cm.get(&#x27;styleselect&#x27;)) {
				t._importClasses();

				formatNames = [];
				each(c.items, function(item) {
					formatNames.push(item.value);
				});

				matches = ed.formatter.matchAll(formatNames);
				c.select(matches[0]);
				tinymce.each(matches, function(match, index) {
					if (index &gt; 0) {
						c.mark(match);
					}
				});
			}

			if (c = cm.get(&#x27;formatselect&#x27;)) {
				p = getParent(ed.dom.isBlock);

				if (p)
					c.select(p.nodeName.toLowerCase());
			}

			&#x2F;&#x2F; Find out current fontSize, fontFamily and fontClass
			getParent(function(n) {
				if (n.nodeName === &#x27;SPAN&#x27;) {
					if (!cl &amp;&amp; n.className)
						cl = n.className;
				}

				if (ed.dom.is(n, s.theme_advanced_font_selector)) {
					if (!fz &amp;&amp; n.style.fontSize)
						fz = n.style.fontSize;

					if (!fn &amp;&amp; n.style.fontFamily)
						fn = n.style.fontFamily.replace(&#x2F;[\&quot;\&#x27;]+&#x2F;g, &#x27;&#x27;).replace(&#x2F;^([^,]+).*&#x2F;, &#x27;$1&#x27;).toLowerCase();

					if (!fc &amp;&amp; n.style.color)
						fc = n.style.color;

					if (!bc &amp;&amp; n.style.backgroundColor)
						bc = n.style.backgroundColor;
				}

				return false;
			});

			if (c = cm.get(&#x27;fontselect&#x27;)) {
				c.select(function(v) {
					return v.replace(&#x2F;^([^,]+).*&#x2F;, &#x27;$1&#x27;).toLowerCase() == fn;
				});
			}

			&#x2F;&#x2F; Select font size
			if (c = cm.get(&#x27;fontsizeselect&#x27;)) {
				&#x2F;&#x2F; Use computed style
				if (s.theme_advanced_runtime_fontsize &amp;&amp; !fz &amp;&amp; !cl)
					fz = ed.dom.getStyle(n, &#x27;fontSize&#x27;, true);

				c.select(function(v) {
					if (v.fontSize &amp;&amp; v.fontSize === fz)
						return true;

					if (v[&#x27;class&#x27;] &amp;&amp; v[&#x27;class&#x27;] === cl)
						return true;
				});
			}

			if (s.theme_advanced_show_current_color) {
				function updateColor(controlId, color) {
					if (c = cm.get(controlId)) {
						if (!color)
							color = c.settings.default_color;
						if (color !== c.value) {
							c.displayColor(color);
						}
					}
				}
				updateColor(&#x27;forecolor&#x27;, fc);
				updateColor(&#x27;backcolor&#x27;, bc);
			}

			if (s.theme_advanced_show_current_color) {
				function updateColor(controlId, color) {
					if (c = cm.get(controlId)) {
						if (!color)
							color = c.settings.default_color;
						if (color !== c.value) {
							c.displayColor(color);
						}
					}
				};

				updateColor(&#x27;forecolor&#x27;, fc);
				updateColor(&#x27;backcolor&#x27;, bc);
			}

			if (s.theme_advanced_path &amp;&amp; s.theme_advanced_statusbar_location) {
				p = DOM.get(ed.id + &#x27;_path&#x27;) || DOM.add(ed.id + &#x27;_path_row&#x27;, &#x27;span&#x27;, {id : ed.id + &#x27;_path&#x27;});

				if (t.statusKeyboardNavigation) {
					t.statusKeyboardNavigation.destroy();
					t.statusKeyboardNavigation = null;
				}

				DOM.setHTML(p, &#x27;&#x27;);

				getParent(function(n) {
					var na = n.nodeName.toLowerCase(), u, pi, ti = &#x27;&#x27;;

					&#x2F;&#x2F; Ignore non element and bogus&#x2F;hidden elements
					if (n.nodeType != 1 || na === &#x27;br&#x27; || n.getAttribute(&#x27;data-mce-bogus&#x27;) || DOM.hasClass(n, &#x27;mceItemHidden&#x27;) || DOM.hasClass(n, &#x27;mceItemRemoved&#x27;))
						return;

					&#x2F;&#x2F; Handle prefix
					if (tinymce.isIE &amp;&amp; n.scopeName !== &#x27;HTML&#x27; &amp;&amp; n.scopeName)
						na = n.scopeName + &#x27;:&#x27; + na;

					&#x2F;&#x2F; Remove internal prefix
					na = na.replace(&#x2F;mce\:&#x2F;g, &#x27;&#x27;);

					&#x2F;&#x2F; Handle node name
					switch (na) {
						case &#x27;b&#x27;:
							na = &#x27;strong&#x27;;
							break;

						case &#x27;i&#x27;:
							na = &#x27;em&#x27;;
							break;

						case &#x27;img&#x27;:
							if (v = DOM.getAttrib(n, &#x27;src&#x27;))
								ti += &#x27;src: &#x27; + v + &#x27; &#x27;;

							break;

						case &#x27;a&#x27;:
							if (v = DOM.getAttrib(n, &#x27;name&#x27;)) {
								ti += &#x27;name: &#x27; + v + &#x27; &#x27;;
								na += &#x27;#&#x27; + v;
							}

							if (v = DOM.getAttrib(n, &#x27;href&#x27;))
								ti += &#x27;href: &#x27; + v + &#x27; &#x27;;

							break;

						case &#x27;font&#x27;:
							if (v = DOM.getAttrib(n, &#x27;face&#x27;))
								ti += &#x27;font: &#x27; + v + &#x27; &#x27;;

							if (v = DOM.getAttrib(n, &#x27;size&#x27;))
								ti += &#x27;size: &#x27; + v + &#x27; &#x27;;

							if (v = DOM.getAttrib(n, &#x27;color&#x27;))
								ti += &#x27;color: &#x27; + v + &#x27; &#x27;;

							break;

						case &#x27;span&#x27;:
							if (v = DOM.getAttrib(n, &#x27;style&#x27;))
								ti += &#x27;style: &#x27; + v + &#x27; &#x27;;

							break;
					}

					if (v = DOM.getAttrib(n, &#x27;id&#x27;))
						ti += &#x27;id: &#x27; + v + &#x27; &#x27;;

					if (v = n.className) {
						v = v.replace(&#x2F;\b\s*(webkit|mce|Apple-)\w+\s*\b&#x2F;g, &#x27;&#x27;);

						if (v) {
							ti += &#x27;class: &#x27; + v + &#x27; &#x27;;

							if (ed.dom.isBlock(n) || na == &#x27;img&#x27; || na == &#x27;span&#x27;)
								na += &#x27;.&#x27; + v;
						}
					}

					na = na.replace(&#x2F;(html:)&#x2F;g, &#x27;&#x27;);
					na = {name : na, node : n, title : ti};
					t.onResolveName.dispatch(t, na);
					ti = na.title;
					na = na.name;

					&#x2F;&#x2F;u = &quot;javascript:tinymce.EditorManager.get(&#x27;&quot; + ed.id + &quot;&#x27;).theme._sel(&#x27;&quot; + (de++) + &quot;&#x27;);&quot;;
					pi = DOM.create(&#x27;a&#x27;, {&#x27;href&#x27; : &quot;javascript:;&quot;, role: &#x27;button&#x27;, onmousedown : &quot;return false;&quot;, title : ti, &#x27;class&#x27; : &#x27;mcePath_&#x27; + (de++)}, na);

					if (p.hasChildNodes()) {
						p.insertBefore(DOM.create(&#x27;span&#x27;, {&#x27;aria-hidden&#x27;: &#x27;true&#x27;}, &#x27;\u00a0\u00bb &#x27;), p.firstChild);
						p.insertBefore(pi, p.firstChild);
					} else
						p.appendChild(pi);
				}, ed.getBody());

				if (DOM.select(&#x27;a&#x27;, p).length &gt; 0) {
					t.statusKeyboardNavigation = new tinymce.ui.KeyboardNavigation({
						root: ed.id + &quot;_path_row&quot;,
						items: DOM.select(&#x27;a&#x27;, p),
						excludeFromTabOrder: true,
						onCancel: function() {
							ed.focus();
						}
					}, DOM);
				}
			}
		},

		&#x2F;&#x2F; Commands gets called by execCommand

		_sel : function(v) {
			this.editor.execCommand(&#x27;mceSelectNodeDepth&#x27;, false, v);
		},

		_mceInsertAnchor : function(ui, v) {
			var ed = this.editor;

			ed.windowManager.open({
				url : this.url + &#x27;&#x2F;anchor.htm&#x27;,
				width : 320 + parseInt(ed.getLang(&#x27;advanced.anchor_delta_width&#x27;, 0)),
				height : 90 + parseInt(ed.getLang(&#x27;advanced.anchor_delta_height&#x27;, 0)),
				inline : true
			}, {
				theme_url : this.url
			});
		},

		_mceCharMap : function() {
			var ed = this.editor;

			ed.windowManager.open({
				url : this.url + &#x27;&#x2F;charmap.htm&#x27;,
				width : 550 + parseInt(ed.getLang(&#x27;advanced.charmap_delta_width&#x27;, 0)),
				height : 265 + parseInt(ed.getLang(&#x27;advanced.charmap_delta_height&#x27;, 0)),
				inline : true
			}, {
				theme_url : this.url
			});
		},

		_mceHelp : function() {
			var ed = this.editor;

			ed.windowManager.open({
				url : this.url + &#x27;&#x2F;about.htm&#x27;,
				width : 480,
				height : 380,
				inline : true
			}, {
				theme_url : this.url
			});
		},

		_mceShortcuts : function() {
			var ed = this.editor;
			ed.windowManager.open({
				url: this.url + &#x27;&#x2F;shortcuts.htm&#x27;,
				width: 480,
				height: 380,
				inline: true
			}, {
				theme_url: this.url
			});
		},

		_mceColorPicker : function(u, v) {
			var ed = this.editor;

			v = v || {};

			ed.windowManager.open({
				url : this.url + &#x27;&#x2F;color_picker.htm&#x27;,
				width : 375 + parseInt(ed.getLang(&#x27;advanced.colorpicker_delta_width&#x27;, 0)),
				height : 250 + parseInt(ed.getLang(&#x27;advanced.colorpicker_delta_height&#x27;, 0)),
				close_previous : false,
				inline : true
			}, {
				input_color : v.color,
				func : v.func,
				theme_url : this.url
			});
		},

		_mceCodeEditor : function(ui, val) {
			var ed = this.editor;

			ed.windowManager.open({
				url : this.url + &#x27;&#x2F;source_editor.htm&#x27;,
				width : parseInt(ed.getParam(&quot;theme_advanced_source_editor_width&quot;, 720)),
				height : parseInt(ed.getParam(&quot;theme_advanced_source_editor_height&quot;, 580)),
				inline : true,
				resizable : true,
				maximizable : true
			}, {
				theme_url : this.url
			});
		},

		_mceImage : function(ui, val) {
			var ed = this.editor;

			&#x2F;&#x2F; Internal image object like a flash placeholder
			if (ed.dom.getAttrib(ed.selection.getNode(), &#x27;class&#x27;, &#x27;&#x27;).indexOf(&#x27;mceItem&#x27;) != -1)
				return;

			ed.windowManager.open({
				url : this.url + &#x27;&#x2F;image.htm&#x27;,
				width : 355 + parseInt(ed.getLang(&#x27;advanced.image_delta_width&#x27;, 0)),
				height : 275 + parseInt(ed.getLang(&#x27;advanced.image_delta_height&#x27;, 0)),
				inline : true
			}, {
				theme_url : this.url
			});
		},

		_mceLink : function(ui, val) {
			var ed = this.editor;

			ed.windowManager.open({
				url : this.url + &#x27;&#x2F;link.htm&#x27;,
				width : 310 + parseInt(ed.getLang(&#x27;advanced.link_delta_width&#x27;, 0)),
				height : 200 + parseInt(ed.getLang(&#x27;advanced.link_delta_height&#x27;, 0)),
				inline : true
			}, {
				theme_url : this.url
			});
		},

		_mceNewDocument : function() {
			var ed = this.editor;

			ed.windowManager.confirm(&#x27;advanced.newdocument&#x27;, function(s) {
				if (s)
					ed.execCommand(&#x27;mceSetContent&#x27;, false, &#x27;&#x27;);
			});
		},

		_mceForeColor : function() {
			var t = this;

			this._mceColorPicker(0, {
				color: t.fgColor,
				func : function(co) {
					t.fgColor = co;
					t.editor.execCommand(&#x27;ForeColor&#x27;, false, co);
				}
			});
		},

		_mceBackColor : function() {
			var t = this;

			this._mceColorPicker(0, {
				color: t.bgColor,
				func : function(co) {
					t.bgColor = co;
					t.editor.execCommand(&#x27;HiliteColor&#x27;, false, co);
				}
			});
		},

		_ufirst : function(s) {
			return s.substring(0, 1).toUpperCase() + s.substring(1);
		}
	});

	tinymce.ThemeManager.add(&#x27;advanced&#x27;, tinymce.themes.AdvancedTheme);
}(tinymce));

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
