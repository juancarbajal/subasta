<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>libs&#x2F;plugins&#x2F;tiny_mce&#x2F;plugins&#x2F;media&#x2F;editor_plugin_src.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.7.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.7.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/admin.html">admin</a></li>
            
                <li><a href="..&#x2F;classes/all-modules.html">all-modules</a></li>
            
                <li><a href="..&#x2F;classes/default.html">default</a></li>
            
                <li><a href="..&#x2F;classes/jcarousel.html">jcarousel</a></li>
            
                <li><a href="..&#x2F;classes/tinymce.plugins.AutoSave.html">tinymce.plugins.AutoSave</a></li>
            
                <li><a href="..&#x2F;classes/tinymce.plugins.ContextMenu.html">tinymce.plugins.ContextMenu</a></li>
            
                <li><a href="..&#x2F;classes/usuario.html">usuario</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/ad-actions.html">ad-actions</a></li>
            
                <li><a href="..&#x2F;modules/add-class-middle.html">add-class-middle</a></li>
            
                <li><a href="..&#x2F;modules/add-favorites.html">add-favorites</a></li>
            
                <li><a href="..&#x2F;modules/all-checked-uncheked.html">all-checked-uncheked</a></li>
            
                <li><a href="..&#x2F;modules/banner-top classified.html">banner-top classified</a></li>
            
                <li><a href="..&#x2F;modules/carousel-products.html">carousel-products</a></li>
            
                <li><a href="..&#x2F;modules/count-word.html">count-word</a></li>
            
                <li><a href="..&#x2F;modules/data-ubigeo.html">data-ubigeo</a></li>
            
                <li><a href="..&#x2F;modules/geotags.html">geotags</a></li>
            
                <li><a href="..&#x2F;modules/impress-ad-list.html">impress-ad-list</a></li>
            
                <li><a href="..&#x2F;modules/lightbox-logIn-signUp.html">lightbox-logIn-signUp</a></li>
            
                <li><a href="..&#x2F;modules/moduleName.html">moduleName</a></li>
            
                <li><a href="..&#x2F;modules/placeholder.html">placeholder</a></li>
            
                <li><a href="..&#x2F;modules/preview-impress.html">preview-impress</a></li>
            
                <li><a href="..&#x2F;modules/register-category.html">register-category</a></li>
            
                <li><a href="..&#x2F;modules/remove-class-home.html">remove-class-home</a></li>
            
                <li><a href="..&#x2F;modules/report-ad.html">report-ad</a></li>
            
                <li><a href="..&#x2F;modules/scrollTop.html">scrollTop</a></li>
            
                <li><a href="..&#x2F;modules/search-categories.html">search-categories</a></li>
            
                <li><a href="..&#x2F;modules/send-ad-friend.html">send-ad-friend</a></li>
            
                <li><a href="..&#x2F;modules/send-list-ad-email.html">send-list-ad-email</a></li>
            
                <li><a href="..&#x2F;modules/show-advanced-search.html">show-advanced-search</a></li>
            
                <li><a href="..&#x2F;modules/show-example-ads.html">show-example-ads</a></li>
            
                <li><a href="..&#x2F;modules/show-login-trigger.html">show-login-trigger</a></li>
            
                <li><a href="..&#x2F;modules/show-photo-products.html">show-photo-products</a></li>
            
                <li><a href="..&#x2F;modules/show-popup.html">show-popup</a></li>
            
                <li><a href="..&#x2F;modules/show-questions.html">show-questions</a></li>
            
                <li><a href="..&#x2F;modules/show-register-trigger.html">show-register-trigger</a></li>
            
                <li><a href="..&#x2F;modules/show-video.html">show-video</a></li>
            
                <li><a href="..&#x2F;modules/showMoreCategories.html">showMoreCategories</a></li>
            
                <li><a href="..&#x2F;modules/some-module4.html">some-module4</a></li>
            
                <li><a href="..&#x2F;modules/tinymce-register.html">tinymce-register</a></li>
            
                <li><a href="..&#x2F;modules/uploader-photos.html">uploader-photos</a></li>
            
                <li><a href="..&#x2F;modules/validate.html">validate</a></li>
            
                <li><a href="..&#x2F;modules/validate-document.html">validate-document</a></li>
            
                <li><a href="..&#x2F;modules/validate-image.html">validate-image</a></li>
            
                <li><a href="..&#x2F;modules/venta.html">venta</a></li>
            
                <li><a href="..&#x2F;modules/yOSON.html">yOSON</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: libs&#x2F;plugins&#x2F;tiny_mce&#x2F;plugins&#x2F;media&#x2F;editor_plugin_src.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * editor_plugin_src.js
 *
 * Copyright 2009, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http:&#x2F;&#x2F;tinymce.moxiecode.com&#x2F;license
 * Contributing: http:&#x2F;&#x2F;tinymce.moxiecode.com&#x2F;contributing
 *&#x2F;

(function() {
	var rootAttributes = tinymce.explode(&#x27;id,name,width,height,style,align,class,hspace,vspace,bgcolor,type&#x27;), excludedAttrs = tinymce.makeMap(rootAttributes.join(&#x27;,&#x27;)), Node = tinymce.html.Node,
		mediaTypes, scriptRegExp, JSON = tinymce.util.JSON, mimeTypes;

	&#x2F;&#x2F; Media types supported by this plugin
	mediaTypes = [
		&#x2F;&#x2F; Type, clsid:s, mime types, codebase
		[&quot;Flash&quot;, &quot;d27cdb6e-ae6d-11cf-96b8-444553540000&quot;, &quot;application&#x2F;x-shockwave-flash&quot;, &quot;http:&#x2F;&#x2F;download.macromedia.com&#x2F;pub&#x2F;shockwave&#x2F;cabs&#x2F;flash&#x2F;swflash.cab#version=6,0,40,0&quot;],
		[&quot;ShockWave&quot;, &quot;166b1bca-3f9c-11cf-8075-444553540000&quot;, &quot;application&#x2F;x-director&quot;, &quot;http:&#x2F;&#x2F;download.macromedia.com&#x2F;pub&#x2F;shockwave&#x2F;cabs&#x2F;director&#x2F;sw.cab#version=8,5,1,0&quot;],
		[&quot;WindowsMedia&quot;, &quot;6bf52a52-394a-11d3-b153-00c04f79faa6,22d6f312-b0f6-11d0-94ab-0080c74c7e95,05589fa1-c356-11ce-bf01-00aa0055595a&quot;, &quot;application&#x2F;x-mplayer2&quot;, &quot;http:&#x2F;&#x2F;activex.microsoft.com&#x2F;activex&#x2F;controls&#x2F;mplayer&#x2F;en&#x2F;nsmp2inf.cab#Version=5,1,52,701&quot;],
		[&quot;QuickTime&quot;, &quot;02bf25d5-8c17-4b23-bc80-d3488abddc6b&quot;, &quot;video&#x2F;quicktime&quot;, &quot;http:&#x2F;&#x2F;www.apple.com&#x2F;qtactivex&#x2F;qtplugin.cab#version=6,0,2,0&quot;],
		[&quot;RealMedia&quot;, &quot;cfcdaa03-8be4-11cf-b84b-0020afbbccfa&quot;, &quot;audio&#x2F;x-pn-realaudio-plugin&quot;, &quot;http:&#x2F;&#x2F;download.macromedia.com&#x2F;pub&#x2F;shockwave&#x2F;cabs&#x2F;flash&#x2F;swflash.cab#version=6,0,40,0&quot;],
		[&quot;Java&quot;, &quot;8ad9c840-044e-11d1-b3e9-00805f499d93&quot;, &quot;application&#x2F;x-java-applet&quot;, &quot;http:&#x2F;&#x2F;java.sun.com&#x2F;products&#x2F;plugin&#x2F;autodl&#x2F;jinstall-1_5_0-windows-i586.cab#Version=1,5,0,0&quot;],
		[&quot;Silverlight&quot;, &quot;dfeaf541-f3e1-4c24-acac-99c30715084a&quot;, &quot;application&#x2F;x-silverlight-2&quot;],
		[&quot;Iframe&quot;],
		[&quot;Video&quot;],
		[&quot;EmbeddedAudio&quot;],
		[&quot;Audio&quot;]
	];

	function normalizeSize(size) {
		return typeof(size) == &quot;string&quot; ? size.replace(&#x2F;[^0-9%]&#x2F;g, &#x27;&#x27;) : size;
	}

	function toArray(obj) {
		var undef, out, i;

		if (obj &amp;&amp; !obj.splice) {
			out = [];

			for (i = 0; true; i++) {
				if (obj[i])
					out[i] = obj[i];
				else
					break;
			}

			return out;
		}

		return obj;
	};

	tinymce.create(&#x27;tinymce.plugins.MediaPlugin&#x27;, {
		init : function(ed, url) {
			var self = this, lookup = {}, i, y, item, name;

			function isMediaImg(node) {
				return node &amp;&amp; node.nodeName === &#x27;IMG&#x27; &amp;&amp; ed.dom.hasClass(node, &#x27;mceItemMedia&#x27;);
			};

			self.editor = ed;
			self.url = url;

			&#x2F;&#x2F; Parse media types into a lookup table
			scriptRegExp = &#x27;&#x27;;
			for (i = 0; i &lt; mediaTypes.length; i++) {
				name = mediaTypes[i][0];

				item = {
					name : name,
					clsids : tinymce.explode(mediaTypes[i][1] || &#x27;&#x27;),
					mimes : tinymce.explode(mediaTypes[i][2] || &#x27;&#x27;),
					codebase : mediaTypes[i][3]
				};

				for (y = 0; y &lt; item.clsids.length; y++)
					lookup[&#x27;clsid:&#x27; + item.clsids[y]] = item;

				for (y = 0; y &lt; item.mimes.length; y++)
					lookup[item.mimes[y]] = item;

				lookup[&#x27;mceItem&#x27; + name] = item;
				lookup[name.toLowerCase()] = item;

				scriptRegExp += (scriptRegExp ? &#x27;|&#x27; : &#x27;&#x27;) + name;
			}

			&#x2F;&#x2F; Handle the media_types setting
			tinymce.each(ed.getParam(&quot;media_types&quot;,
				&quot;video=mp4,m4v,ogv,webm;&quot; +
				&quot;silverlight=xap;&quot; +
				&quot;flash=swf,flv;&quot; +
				&quot;shockwave=dcr;&quot; +
				&quot;quicktime=mov,qt,mpg,mpeg;&quot; +
				&quot;shockwave=dcr;&quot; +
				&quot;windowsmedia=avi,wmv,wm,asf,asx,wmx,wvx;&quot; +
				&quot;realmedia=rm,ra,ram;&quot; +
				&quot;java=jar;&quot; +
				&quot;audio=mp3,ogg&quot;
			).split(&#x27;;&#x27;), function(item) {
				var i, extensions, type;

				item = item.split(&#x2F;=&#x2F;);
				extensions = tinymce.explode(item[1].toLowerCase());
				for (i = 0; i &lt; extensions.length; i++) {
					type = lookup[item[0].toLowerCase()];

					if (type)
						lookup[extensions[i]] = type;
				}
			});

			scriptRegExp = new RegExp(&#x27;write(&#x27; + scriptRegExp + &#x27;)\\(([^)]+)\\)&#x27;);
			self.lookup = lookup;

			ed.onPreInit.add(function() {
				&#x2F;&#x2F; Allow video elements
				ed.schema.addValidElements(&#x27;object[id|style|width|height|classid|codebase|*],param[name|value],embed[id|style|width|height|type|src|*],video[*],audio[*],source[*]&#x27;);

				&#x2F;&#x2F; Convert video elements to image placeholder
				ed.parser.addNodeFilter(&#x27;object,embed,video,audio,script,iframe&#x27;, function(nodes) {
					var i = nodes.length;

					while (i--)
						self.objectToImg(nodes[i]);
				});

				&#x2F;&#x2F; Convert image placeholders to video elements
				ed.serializer.addNodeFilter(&#x27;img&#x27;, function(nodes, name, args) {
					var i = nodes.length, node;

					while (i--) {
						node = nodes[i];
						if ((node.attr(&#x27;class&#x27;) || &#x27;&#x27;).indexOf(&#x27;mceItemMedia&#x27;) !== -1)
							self.imgToObject(node, args);
					}
				});
			});

			ed.onInit.add(function() {
				&#x2F;&#x2F; Display &quot;media&quot; instead of &quot;img&quot; in element path
				if (ed.theme &amp;&amp; ed.theme.onResolveName) {
					ed.theme.onResolveName.add(function(theme, path_object) {
						if (path_object.name === &#x27;img&#x27; &amp;&amp; ed.dom.hasClass(path_object.node, &#x27;mceItemMedia&#x27;))
							path_object.name = &#x27;media&#x27;;
					});
				}

				&#x2F;&#x2F; Add contect menu if it&#x27;s loaded
				if (ed &amp;&amp; ed.plugins.contextmenu) {
					ed.plugins.contextmenu.onContextMenu.add(function(plugin, menu, element) {
						if (element.nodeName === &#x27;IMG&#x27; &amp;&amp; element.className.indexOf(&#x27;mceItemMedia&#x27;) !== -1)
							menu.add({title : &#x27;media.edit&#x27;, icon : &#x27;media&#x27;, cmd : &#x27;mceMedia&#x27;});
					});
				}
			});

			&#x2F;&#x2F; Register commands
			ed.addCommand(&#x27;mceMedia&#x27;, function() {
				var data, img;

				img = ed.selection.getNode();
				if (isMediaImg(img)) {
					data = ed.dom.getAttrib(img, &#x27;data-mce-json&#x27;);
					if (data) {
						data = JSON.parse(data);

						&#x2F;&#x2F; Add some extra properties to the data object
						tinymce.each(rootAttributes, function(name) {
							var value = ed.dom.getAttrib(img, name);

							if (value)
								data[name] = value;
						});

						data.type = self.getType(img.className).name.toLowerCase();
					}
				}

				if (!data) {
					data = {
						type : &#x27;flash&#x27;,
						video: {sources:[]},
						params: {}
					};
				}

				ed.windowManager.open({
					file : url + &#x27;&#x2F;media.htm&#x27;,
					width : 430 + parseInt(ed.getLang(&#x27;media.delta_width&#x27;, 0)),
					height : 500 + parseInt(ed.getLang(&#x27;media.delta_height&#x27;, 0)),
					inline : 1
				}, {
					plugin_url : url,
					data : data
				});
			});

			&#x2F;&#x2F; Register buttons
			ed.addButton(&#x27;media&#x27;, {title : &#x27;media.desc&#x27;, cmd : &#x27;mceMedia&#x27;});

			&#x2F;&#x2F; Update media selection status
			ed.onNodeChange.add(function(ed, cm, node) {
				cm.setActive(&#x27;media&#x27;, isMediaImg(node));
			});
		},

		convertUrl : function(url, force_absolute) {
			var self = this, editor = self.editor, settings = editor.settings,
				urlConverter = settings.url_converter,
				urlConverterScope = settings.url_converter_scope || self;

			if (!url)
				return url;

			if (force_absolute)
				return editor.documentBaseURI.toAbsolute(url);

			return urlConverter.call(urlConverterScope, url, &#x27;src&#x27;, &#x27;object&#x27;);
		},

		getInfo : function() {
			return {
				longname : &#x27;Media&#x27;,
				author : &#x27;Moxiecode Systems AB&#x27;,
				authorurl : &#x27;http:&#x2F;&#x2F;tinymce.moxiecode.com&#x27;,
				infourl : &#x27;http:&#x2F;&#x2F;wiki.moxiecode.com&#x2F;index.php&#x2F;TinyMCE:Plugins&#x2F;media&#x27;,
				version : tinymce.majorVersion + &quot;.&quot; + tinymce.minorVersion
			};
		},

		&#x2F;**
		 * Converts the JSON data object to an img node.
		 *&#x2F;
		dataToImg : function(data, force_absolute) {
			var self = this, editor = self.editor, baseUri = editor.documentBaseURI, sources, attrs, img, i;

			data.params.src = self.convertUrl(data.params.src, force_absolute);

			attrs = data.video.attrs;
			if (attrs)
				attrs.src = self.convertUrl(attrs.src, force_absolute);

			if (attrs)
				attrs.poster = self.convertUrl(attrs.poster, force_absolute);

			sources = toArray(data.video.sources);
			if (sources) {
				for (i = 0; i &lt; sources.length; i++)
					sources[i].src = self.convertUrl(sources[i].src, force_absolute);
			}

			img = self.editor.dom.create(&#x27;img&#x27;, {
				id : data.id,
				style : data.style,
				align : data.align,
				hspace : data.hspace,
				vspace : data.vspace,
				src : self.editor.theme.url + &#x27;&#x2F;img&#x2F;trans.gif&#x27;,
				&#x27;class&#x27; : &#x27;mceItemMedia mceItem&#x27; + self.getType(data.type).name,
				&#x27;data-mce-json&#x27; : JSON.serialize(data, &quot;&#x27;&quot;)
			});

			img.width = data.width = normalizeSize(data.width || (data.type == &#x27;audio&#x27; ? &quot;300&quot; : &quot;320&quot;));
			img.height = data.height = normalizeSize(data.height || (data.type == &#x27;audio&#x27; ? &quot;32&quot; : &quot;240&quot;));

			return img;
		},

		&#x2F;**
		 * Converts the JSON data object to a HTML string.
		 *&#x2F;
		dataToHtml : function(data, force_absolute) {
			return this.editor.serializer.serialize(this.dataToImg(data, force_absolute), {forced_root_block : &#x27;&#x27;, force_absolute : force_absolute});
		},

		&#x2F;**
		 * Converts the JSON data object to a HTML string.
		 *&#x2F;
		htmlToData : function(html) {
			var fragment, img, data;

			data = {
				type : &#x27;flash&#x27;,
				video: {sources:[]},
				params: {}
			};

			fragment = this.editor.parser.parse(html);
			img = fragment.getAll(&#x27;img&#x27;)[0];

			if (img) {
				data = JSON.parse(img.attr(&#x27;data-mce-json&#x27;));
				data.type = this.getType(img.attr(&#x27;class&#x27;)).name.toLowerCase();

				&#x2F;&#x2F; Add some extra properties to the data object
				tinymce.each(rootAttributes, function(name) {
					var value = img.attr(name);

					if (value)
						data[name] = value;
				});
			}

			return data;
		},

		&#x2F;**
		 * Get type item by extension, class, clsid or mime type.
		 *
		 * @method getType
		 * @param {String} value Value to get type item by.
		 * @return {Object} Type item object or undefined.
		 *&#x2F;
		getType : function(value) {
			var i, values, typeItem;

			&#x2F;&#x2F; Find type by checking the classes
			values = tinymce.explode(value, &#x27; &#x27;);
			for (i = 0; i &lt; values.length; i++) {
				typeItem = this.lookup[values[i]];

				if (typeItem)
					return typeItem;
			}
		},

		&#x2F;**
		 * Converts a tinymce.html.Node image element to video&#x2F;object&#x2F;embed.
		 *&#x2F;
		imgToObject : function(node, args) {
			var self = this, editor = self.editor, video, object, embed, iframe, name, value, data,
				source, sources, params, param, typeItem, i, item, mp4Source, replacement,
				posterSrc, style, audio;

			&#x2F;&#x2F; Adds the flash player
			function addPlayer(video_src, poster_src) {
				var baseUri, flashVars, flashVarsOutput, params, flashPlayer;

				flashPlayer = editor.getParam(&#x27;flash_video_player_url&#x27;, self.convertUrl(self.url + &#x27;&#x2F;moxieplayer.swf&#x27;));
				if (flashPlayer) {
					baseUri = editor.documentBaseURI;
					data.params.src = flashPlayer;

					&#x2F;&#x2F; Convert the movie url to absolute urls
					if (editor.getParam(&#x27;flash_video_player_absvideourl&#x27;, true)) {
						video_src = baseUri.toAbsolute(video_src || &#x27;&#x27;, true);
						poster_src = baseUri.toAbsolute(poster_src || &#x27;&#x27;, true);
					}

					&#x2F;&#x2F; Generate flash vars
					flashVarsOutput = &#x27;&#x27;;
					flashVars = editor.getParam(&#x27;flash_video_player_flashvars&#x27;, {url : &#x27;$url&#x27;, poster : &#x27;$poster&#x27;});
					tinymce.each(flashVars, function(value, name) {
						&#x2F;&#x2F; Replace $url and $poster variables in flashvars value
						value = value.replace(&#x2F;\$url&#x2F;, video_src || &#x27;&#x27;);
						value = value.replace(&#x2F;\$poster&#x2F;, poster_src || &#x27;&#x27;);

						if (value.length &gt; 0)
							flashVarsOutput += (flashVarsOutput ? &#x27;&amp;&#x27; : &#x27;&#x27;) + name + &#x27;=&#x27; + escape(value);
					});

					if (flashVarsOutput.length)
						data.params.flashvars = flashVarsOutput;

					params = editor.getParam(&#x27;flash_video_player_params&#x27;, {
						allowfullscreen: true,
						allowscriptaccess: true
					});

					tinymce.each(params, function(value, name) {
						data.params[name] = &quot;&quot; + value;
					});
				}
			};

			data = node.attr(&#x27;data-mce-json&#x27;);
			if (!data)
				return;

			data = JSON.parse(data);
			typeItem = this.getType(node.attr(&#x27;class&#x27;));

			style = node.attr(&#x27;data-mce-style&#x27;);
			if (!style) {
				style = node.attr(&#x27;style&#x27;);

				if (style)
					style = editor.dom.serializeStyle(editor.dom.parseStyle(style, &#x27;img&#x27;));
			}

			&#x2F;&#x2F; Use node width&#x2F;height to override the data width&#x2F;height when the placeholder is resized
			data.width = node.attr(&#x27;width&#x27;) || data.width;
			data.height = node.attr(&#x27;height&#x27;) || data.height;

			&#x2F;&#x2F; Handle iframe
			if (typeItem.name === &#x27;Iframe&#x27;) {
				replacement = new Node(&#x27;iframe&#x27;, 1);

				tinymce.each(rootAttributes, function(name) {
					var value = node.attr(name);

					if (name == &#x27;class&#x27; &amp;&amp; value)
						value = value.replace(&#x2F;mceItem.+ ?&#x2F;g, &#x27;&#x27;);

					if (value &amp;&amp; value.length &gt; 0)
						replacement.attr(name, value);
				});

				for (name in data.params)
					replacement.attr(name, data.params[name]);

				replacement.attr({
					style: style,
					src: data.params.src
				});

				node.replace(replacement);

				return;
			}

			&#x2F;&#x2F; Handle scripts
			if (this.editor.settings.media_use_script) {
				replacement = new Node(&#x27;script&#x27;, 1).attr(&#x27;type&#x27;, &#x27;text&#x2F;javascript&#x27;);

				value = new Node(&#x27;#text&#x27;, 3);
				value.value = &#x27;write&#x27; + typeItem.name + &#x27;(&#x27; + JSON.serialize(tinymce.extend(data.params, {
					width: node.attr(&#x27;width&#x27;),
					height: node.attr(&#x27;height&#x27;)
				})) + &#x27;);&#x27;;

				replacement.append(value);
				node.replace(replacement);

				return;
			}

			&#x2F;&#x2F; Add HTML5 video element
			if (typeItem.name === &#x27;Video&#x27; &amp;&amp; data.video.sources[0]) {
				&#x2F;&#x2F; Create new object element
				video = new Node(&#x27;video&#x27;, 1).attr(tinymce.extend({
					id : node.attr(&#x27;id&#x27;),
					width: normalizeSize(node.attr(&#x27;width&#x27;)),
					height: normalizeSize(node.attr(&#x27;height&#x27;)),
					style : style
				}, data.video.attrs));

				&#x2F;&#x2F; Get poster source and use that for flash fallback
				if (data.video.attrs)
					posterSrc = data.video.attrs.poster;

				sources = data.video.sources = toArray(data.video.sources);
				for (i = 0; i &lt; sources.length; i++) {
					if (&#x2F;\.mp4$&#x2F;.test(sources[i].src))
						mp4Source = sources[i].src;
				}

				if (!sources[0].type) {
					video.attr(&#x27;src&#x27;, sources[0].src);
					sources.splice(0, 1);
				}

				for (i = 0; i &lt; sources.length; i++) {
					source = new Node(&#x27;source&#x27;, 1).attr(sources[i]);
					source.shortEnded = true;
					video.append(source);
				}

				&#x2F;&#x2F; Create flash fallback for video if we have a mp4 source
				if (mp4Source) {
					addPlayer(mp4Source, posterSrc);
					typeItem = self.getType(&#x27;flash&#x27;);
				} else
					data.params.src = &#x27;&#x27;;
			}

			&#x2F;&#x2F; Add HTML5 audio element
			if (typeItem.name === &#x27;Audio&#x27; &amp;&amp; data.video.sources[0]) {
				&#x2F;&#x2F; Create new object element
				audio = new Node(&#x27;audio&#x27;, 1).attr(tinymce.extend({
					id : node.attr(&#x27;id&#x27;),
					width: normalizeSize(node.attr(&#x27;width&#x27;)),
					height: normalizeSize(node.attr(&#x27;height&#x27;)),
					style : style
				}, data.video.attrs));

				&#x2F;&#x2F; Get poster source and use that for flash fallback
				if (data.video.attrs)
					posterSrc = data.video.attrs.poster;

				sources = data.video.sources = toArray(data.video.sources);
				if (!sources[0].type) {
					audio.attr(&#x27;src&#x27;, sources[0].src);
					sources.splice(0, 1);
				}

				for (i = 0; i &lt; sources.length; i++) {
					source = new Node(&#x27;source&#x27;, 1).attr(sources[i]);
					source.shortEnded = true;
					audio.append(source);
				}

				data.params.src = &#x27;&#x27;;
			}

			if (typeItem.name === &#x27;EmbeddedAudio&#x27;) {
				embed = new Node(&#x27;embed&#x27;, 1);
				embed.shortEnded = true;
				embed.attr({
					id: node.attr(&#x27;id&#x27;),
					width: normalizeSize(node.attr(&#x27;width&#x27;)),
					height: normalizeSize(node.attr(&#x27;height&#x27;)),
					style : style,
					type: node.attr(&#x27;type&#x27;)
				});

				for (name in data.params)
					embed.attr(name, data.params[name]);

				tinymce.each(rootAttributes, function(name) {
					if (data[name] &amp;&amp; name != &#x27;type&#x27;)
						embed.attr(name, data[name]);
				});

				data.params.src = &#x27;&#x27;;
			}

			&#x2F;&#x2F; Do we have a params src then we can generate object
			if (data.params.src) {
				&#x2F;&#x2F; Is flv movie add player for it
				if (&#x2F;\.flv$&#x2F;i.test(data.params.src))
					addPlayer(data.params.src, &#x27;&#x27;);

				if (args &amp;&amp; args.force_absolute)
					data.params.src = editor.documentBaseURI.toAbsolute(data.params.src);

				&#x2F;&#x2F; Create new object element
				object = new Node(&#x27;object&#x27;, 1).attr({
					id : node.attr(&#x27;id&#x27;),
					width: normalizeSize(node.attr(&#x27;width&#x27;)),
					height: normalizeSize(node.attr(&#x27;height&#x27;)),
					style : style
				});

				tinymce.each(rootAttributes, function(name) {
					var value = data[name];

					if (name == &#x27;class&#x27; &amp;&amp; value)
						value = value.replace(&#x2F;mceItem.+ ?&#x2F;g, &#x27;&#x27;);

					if (value &amp;&amp; name != &#x27;type&#x27;)
						object.attr(name, value);
				});

				&#x2F;&#x2F; Add params
				for (name in data.params) {
					param = new Node(&#x27;param&#x27;, 1);
					param.shortEnded = true;
					value = data.params[name];

					&#x2F;&#x2F; Windows media needs to use url instead of src for the media URL
					if (name === &#x27;src&#x27; &amp;&amp; typeItem.name === &#x27;WindowsMedia&#x27;)
						name = &#x27;url&#x27;;

					param.attr({name: name, value: value});
					object.append(param);
				}

				&#x2F;&#x2F; Setup add type and classid if strict is disabled
				if (this.editor.getParam(&#x27;media_strict&#x27;, true)) {
					object.attr({
						data: data.params.src,
						type: typeItem.mimes[0]
					});
				} else {
					object.attr({
						classid: &quot;clsid:&quot; + typeItem.clsids[0],
						codebase: typeItem.codebase
					});

					embed = new Node(&#x27;embed&#x27;, 1);
					embed.shortEnded = true;
					embed.attr({
						id: node.attr(&#x27;id&#x27;),
						width: normalizeSize(node.attr(&#x27;width&#x27;)),
						height: normalizeSize(node.attr(&#x27;height&#x27;)),
						style : style,
						type: typeItem.mimes[0]
					});

					for (name in data.params)
						embed.attr(name, data.params[name]);

					tinymce.each(rootAttributes, function(name) {
						if (data[name] &amp;&amp; name != &#x27;type&#x27;)
							embed.attr(name, data[name]);
					});

					object.append(embed);
				}

				&#x2F;&#x2F; Insert raw HTML
				if (data.object_html) {
					value = new Node(&#x27;#text&#x27;, 3);
					value.raw = true;
					value.value = data.object_html;
					object.append(value);
				}

				&#x2F;&#x2F; Append object to video element if it exists
				if (video)
					video.append(object);
			}

			if (video) {
				&#x2F;&#x2F; Insert raw HTML
				if (data.video_html) {
					value = new Node(&#x27;#text&#x27;, 3);
					value.raw = true;
					value.value = data.video_html;
					video.append(value);
				}
			}

			if (audio) {
				&#x2F;&#x2F; Insert raw HTML
				if (data.video_html) {
					value = new Node(&#x27;#text&#x27;, 3);
					value.raw = true;
					value.value = data.video_html;
					audio.append(value);
				}
			}

			var n = video || audio || object || embed;
			if (n)
				node.replace(n);
			else
				node.remove();
		},

		&#x2F;**
		 * Converts a tinymce.html.Node video&#x2F;object&#x2F;embed to an img element.
		 *
		 * The video&#x2F;object&#x2F;embed will be converted into an image placeholder with a JSON data attribute like this:
		 * &lt;img class=&quot;mceItemMedia mceItemFlash&quot; width=&quot;100&quot; height=&quot;100&quot; data-mce-json=&quot;{..}&quot; &#x2F;&gt;
		 *
		 * The JSON structure will be like this:
		 * {&#x27;params&#x27;:{&#x27;flashvars&#x27;:&#x27;something&#x27;,&#x27;quality&#x27;:&#x27;high&#x27;,&#x27;src&#x27;:&#x27;someurl&#x27;}, &#x27;video&#x27;:{&#x27;sources&#x27;:[{src: &#x27;someurl&#x27;, type: &#x27;video&#x2F;mp4&#x27;}]}}
		 *&#x2F;
		objectToImg : function(node) {
			var object, embed, video, iframe, img, name, id, width, height, style, i, html,
				param, params, source, sources, data, type, lookup = this.lookup,
				matches, attrs, urlConverter = this.editor.settings.url_converter,
				urlConverterScope = this.editor.settings.url_converter_scope,
				hspace, vspace, align, bgcolor;

			function getInnerHTML(node) {
				return new tinymce.html.Serializer({
					inner: true,
					validate: false
				}).serialize(node);
			};

			function lookupAttribute(o, attr) {
				return lookup[(o.attr(attr) || &#x27;&#x27;).toLowerCase()];
			}

			function lookupExtension(src) {
				var ext = src.replace(&#x2F;^.*\.([^.]+)$&#x2F;, &#x27;$1&#x27;);
				return lookup[ext.toLowerCase() || &#x27;&#x27;];
			}

			&#x2F;&#x2F; If node isn&#x27;t in document
			if (!node.parent)
				return;

			&#x2F;&#x2F; Handle media scripts
			if (node.name === &#x27;script&#x27;) {
				if (node.firstChild)
					matches = scriptRegExp.exec(node.firstChild.value);

				if (!matches)
					return;

				type = matches[1];
				data = {video : {}, params : JSON.parse(matches[2])};
				width = data.params.width;
				height = data.params.height;
			}

			&#x2F;&#x2F; Setup data objects
			data = data || {
				video : {},
				params : {}
			};

			&#x2F;&#x2F; Setup new image object
			img = new Node(&#x27;img&#x27;, 1);
			img.attr({
				src : this.editor.theme.url + &#x27;&#x2F;img&#x2F;trans.gif&#x27;
			});

			&#x2F;&#x2F; Video element
			name = node.name;
			if (name === &#x27;video&#x27; || name == &#x27;audio&#x27;) {
				video = node;
				object = node.getAll(&#x27;object&#x27;)[0];
				embed = node.getAll(&#x27;embed&#x27;)[0];
				width = video.attr(&#x27;width&#x27;);
				height = video.attr(&#x27;height&#x27;);
				id = video.attr(&#x27;id&#x27;);
				data.video = {attrs : {}, sources : []};

				&#x2F;&#x2F; Get all video attributes
				attrs = data.video.attrs;
				for (name in video.attributes.map)
					attrs[name] = video.attributes.map[name];

				source = node.attr(&#x27;src&#x27;);
				if (source)
					data.video.sources.push({src : urlConverter.call(urlConverterScope, source, &#x27;src&#x27;, node.name)});

				&#x2F;&#x2F; Get all sources
				sources = video.getAll(&quot;source&quot;);
				for (i = 0; i &lt; sources.length; i++) {
					source = sources[i].remove();

					data.video.sources.push({
						src: urlConverter.call(urlConverterScope, source.attr(&#x27;src&#x27;), &#x27;src&#x27;, &#x27;source&#x27;),
						type: source.attr(&#x27;type&#x27;),
						media: source.attr(&#x27;media&#x27;)
					});
				}

				&#x2F;&#x2F; Convert the poster URL
				if (attrs.poster)
					attrs.poster = urlConverter.call(urlConverterScope, attrs.poster, &#x27;poster&#x27;, node.name);
			}

			&#x2F;&#x2F; Object element
			if (node.name === &#x27;object&#x27;) {
				object = node;
				embed = node.getAll(&#x27;embed&#x27;)[0];
			}

			&#x2F;&#x2F; Embed element
			if (node.name === &#x27;embed&#x27;)
				embed = node;

			&#x2F;&#x2F; Iframe element
			if (node.name === &#x27;iframe&#x27;) {
				iframe = node;
				type = &#x27;Iframe&#x27;;
			}

			if (object) {
				&#x2F;&#x2F; Get width&#x2F;height
				width = width || object.attr(&#x27;width&#x27;);
				height = height || object.attr(&#x27;height&#x27;);
				style = style || object.attr(&#x27;style&#x27;);
				id = id || object.attr(&#x27;id&#x27;);
				hspace = hspace || object.attr(&#x27;hspace&#x27;);
				vspace = vspace || object.attr(&#x27;vspace&#x27;);
				align = align || object.attr(&#x27;align&#x27;);
				bgcolor = bgcolor || object.attr(&#x27;bgcolor&#x27;);
				data.name = object.attr(&#x27;name&#x27;);

				&#x2F;&#x2F; Get all object params
				params = object.getAll(&quot;param&quot;);
				for (i = 0; i &lt; params.length; i++) {
					param = params[i];
					name = param.remove().attr(&#x27;name&#x27;);

					if (!excludedAttrs[name])
						data.params[name] = param.attr(&#x27;value&#x27;);
				}

				data.params.src = data.params.src || object.attr(&#x27;data&#x27;);
			}

			if (embed) {
				&#x2F;&#x2F; Get width&#x2F;height
				width = width || embed.attr(&#x27;width&#x27;);
				height = height || embed.attr(&#x27;height&#x27;);
				style = style || embed.attr(&#x27;style&#x27;);
				id = id || embed.attr(&#x27;id&#x27;);
				hspace = hspace || embed.attr(&#x27;hspace&#x27;);
				vspace = vspace || embed.attr(&#x27;vspace&#x27;);
				align = align || embed.attr(&#x27;align&#x27;);
				bgcolor = bgcolor || embed.attr(&#x27;bgcolor&#x27;);

				&#x2F;&#x2F; Get all embed attributes
				for (name in embed.attributes.map) {
					if (!excludedAttrs[name] &amp;&amp; !data.params[name])
						data.params[name] = embed.attributes.map[name];
				}
			}

			if (iframe) {
				&#x2F;&#x2F; Get width&#x2F;height
				width = normalizeSize(iframe.attr(&#x27;width&#x27;));
				height = normalizeSize(iframe.attr(&#x27;height&#x27;));
				style = style || iframe.attr(&#x27;style&#x27;);
				id = iframe.attr(&#x27;id&#x27;);
				hspace = iframe.attr(&#x27;hspace&#x27;);
				vspace = iframe.attr(&#x27;vspace&#x27;);
				align = iframe.attr(&#x27;align&#x27;);
				bgcolor = iframe.attr(&#x27;bgcolor&#x27;);

				tinymce.each(rootAttributes, function(name) {
					img.attr(name, iframe.attr(name));
				});

				&#x2F;&#x2F; Get all iframe attributes
				for (name in iframe.attributes.map) {
					if (!excludedAttrs[name] &amp;&amp; !data.params[name])
						data.params[name] = iframe.attributes.map[name];
				}
			}

			&#x2F;&#x2F; Use src not movie
			if (data.params.movie) {
				data.params.src = data.params.src || data.params.movie;
				delete data.params.movie;
			}

			&#x2F;&#x2F; Convert the URL to relative&#x2F;absolute depending on configuration
			if (data.params.src)
				data.params.src = urlConverter.call(urlConverterScope, data.params.src, &#x27;src&#x27;, &#x27;object&#x27;);

			if (video) {
				if (node.name === &#x27;video&#x27;)
					type = lookup.video.name;
				else if (node.name === &#x27;audio&#x27;)
					type = lookup.audio.name;
			}

			if (object &amp;&amp; !type)
				type = (lookupAttribute(object, &#x27;clsid&#x27;) || lookupAttribute(object, &#x27;classid&#x27;) || lookupAttribute(object, &#x27;type&#x27;) || {}).name;

			if (embed &amp;&amp; !type)
				type = (lookupAttribute(embed, &#x27;type&#x27;) || lookupExtension(data.params.src) || {}).name;

			&#x2F;&#x2F; for embedded audio we preserve the original specified type
			if (embed &amp;&amp; type == &#x27;EmbeddedAudio&#x27;) {
				data.params.type = embed.attr(&#x27;type&#x27;);
			}

			&#x2F;&#x2F; Replace the video&#x2F;object&#x2F;embed element with a placeholder image containing the data
			node.replace(img);

			&#x2F;&#x2F; Remove embed
			if (embed)
				embed.remove();

			&#x2F;&#x2F; Serialize the inner HTML of the object element
			if (object) {
				html = getInnerHTML(object.remove());

				if (html)
					data.object_html = html;
			}

			&#x2F;&#x2F; Serialize the inner HTML of the video element
			if (video) {
				html = getInnerHTML(video.remove());

				if (html)
					data.video_html = html;
			}

			data.hspace = hspace;
			data.vspace = vspace;
			data.align = align;
			data.bgcolor = bgcolor;

			&#x2F;&#x2F; Set width&#x2F;height of placeholder
			img.attr({
				id : id,
				&#x27;class&#x27; : &#x27;mceItemMedia mceItem&#x27; + (type || &#x27;Flash&#x27;),
				style : style,
				width : width || (node.name == &#x27;audio&#x27; ? &quot;300&quot; : &quot;320&quot;),
				height : height || (node.name == &#x27;audio&#x27; ? &quot;32&quot; : &quot;240&quot;),
				hspace : hspace,
				vspace : vspace,
				align : align,
				bgcolor : bgcolor,
				&quot;data-mce-json&quot; : JSON.serialize(data, &quot;&#x27;&quot;)
			});
		}
	});

	&#x2F;&#x2F; Register plugin
	tinymce.PluginManager.add(&#x27;media&#x27;, tinymce.plugins.MediaPlugin);
})();

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
