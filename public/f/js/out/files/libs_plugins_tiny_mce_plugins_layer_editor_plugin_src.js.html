<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>libs&#x2F;plugins&#x2F;tiny_mce&#x2F;plugins&#x2F;layer&#x2F;editor_plugin_src.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.7.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.7.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/admin.html">admin</a></li>
            
                <li><a href="..&#x2F;classes/all-modules.html">all-modules</a></li>
            
                <li><a href="..&#x2F;classes/default.html">default</a></li>
            
                <li><a href="..&#x2F;classes/jcarousel.html">jcarousel</a></li>
            
                <li><a href="..&#x2F;classes/tinymce.plugins.AutoSave.html">tinymce.plugins.AutoSave</a></li>
            
                <li><a href="..&#x2F;classes/tinymce.plugins.ContextMenu.html">tinymce.plugins.ContextMenu</a></li>
            
                <li><a href="..&#x2F;classes/usuario.html">usuario</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="..&#x2F;modules/ad-actions.html">ad-actions</a></li>
            
                <li><a href="..&#x2F;modules/add-class-middle.html">add-class-middle</a></li>
            
                <li><a href="..&#x2F;modules/add-favorites.html">add-favorites</a></li>
            
                <li><a href="..&#x2F;modules/all-checked-uncheked.html">all-checked-uncheked</a></li>
            
                <li><a href="..&#x2F;modules/banner-top classified.html">banner-top classified</a></li>
            
                <li><a href="..&#x2F;modules/carousel-products.html">carousel-products</a></li>
            
                <li><a href="..&#x2F;modules/count-word.html">count-word</a></li>
            
                <li><a href="..&#x2F;modules/data-ubigeo.html">data-ubigeo</a></li>
            
                <li><a href="..&#x2F;modules/geotags.html">geotags</a></li>
            
                <li><a href="..&#x2F;modules/impress-ad-list.html">impress-ad-list</a></li>
            
                <li><a href="..&#x2F;modules/lightbox-logIn-signUp.html">lightbox-logIn-signUp</a></li>
            
                <li><a href="..&#x2F;modules/moduleName.html">moduleName</a></li>
            
                <li><a href="..&#x2F;modules/placeholder.html">placeholder</a></li>
            
                <li><a href="..&#x2F;modules/preview-impress.html">preview-impress</a></li>
            
                <li><a href="..&#x2F;modules/register-category.html">register-category</a></li>
            
                <li><a href="..&#x2F;modules/remove-class-home.html">remove-class-home</a></li>
            
                <li><a href="..&#x2F;modules/report-ad.html">report-ad</a></li>
            
                <li><a href="..&#x2F;modules/scrollTop.html">scrollTop</a></li>
            
                <li><a href="..&#x2F;modules/search-categories.html">search-categories</a></li>
            
                <li><a href="..&#x2F;modules/send-ad-friend.html">send-ad-friend</a></li>
            
                <li><a href="..&#x2F;modules/send-list-ad-email.html">send-list-ad-email</a></li>
            
                <li><a href="..&#x2F;modules/show-advanced-search.html">show-advanced-search</a></li>
            
                <li><a href="..&#x2F;modules/show-example-ads.html">show-example-ads</a></li>
            
                <li><a href="..&#x2F;modules/show-login-trigger.html">show-login-trigger</a></li>
            
                <li><a href="..&#x2F;modules/show-photo-products.html">show-photo-products</a></li>
            
                <li><a href="..&#x2F;modules/show-popup.html">show-popup</a></li>
            
                <li><a href="..&#x2F;modules/show-questions.html">show-questions</a></li>
            
                <li><a href="..&#x2F;modules/show-register-trigger.html">show-register-trigger</a></li>
            
                <li><a href="..&#x2F;modules/show-video.html">show-video</a></li>
            
                <li><a href="..&#x2F;modules/showMoreCategories.html">showMoreCategories</a></li>
            
                <li><a href="..&#x2F;modules/some-module4.html">some-module4</a></li>
            
                <li><a href="..&#x2F;modules/tinymce-register.html">tinymce-register</a></li>
            
                <li><a href="..&#x2F;modules/uploader-photos.html">uploader-photos</a></li>
            
                <li><a href="..&#x2F;modules/validate.html">validate</a></li>
            
                <li><a href="..&#x2F;modules/validate-document.html">validate-document</a></li>
            
                <li><a href="..&#x2F;modules/validate-image.html">validate-image</a></li>
            
                <li><a href="..&#x2F;modules/venta.html">venta</a></li>
            
                <li><a href="..&#x2F;modules/yOSON.html">yOSON</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: libs&#x2F;plugins&#x2F;tiny_mce&#x2F;plugins&#x2F;layer&#x2F;editor_plugin_src.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;**
 * editor_plugin_src.js
 *
 * Copyright 2009, Moxiecode Systems AB
 * Released under LGPL License.
 *
 * License: http:&#x2F;&#x2F;tinymce.moxiecode.com&#x2F;license
 * Contributing: http:&#x2F;&#x2F;tinymce.moxiecode.com&#x2F;contributing
 *&#x2F;

(function() {
	function findParentLayer(node) {
		do {
			if (node.className &amp;&amp; node.className.indexOf(&#x27;mceItemLayer&#x27;) != -1) {
				return node;
			}
		} while (node = node.parentNode);
	};

	tinymce.create(&#x27;tinymce.plugins.Layer&#x27;, {
		init : function(ed, url) {
			var t = this;

			t.editor = ed;

			&#x2F;&#x2F; Register commands
			ed.addCommand(&#x27;mceInsertLayer&#x27;, t._insertLayer, t);

			ed.addCommand(&#x27;mceMoveForward&#x27;, function() {
				t._move(1);
			});

			ed.addCommand(&#x27;mceMoveBackward&#x27;, function() {
				t._move(-1);
			});

			ed.addCommand(&#x27;mceMakeAbsolute&#x27;, function() {
				t._toggleAbsolute();
			});

			&#x2F;&#x2F; Register buttons
			ed.addButton(&#x27;moveforward&#x27;, {title : &#x27;layer.forward_desc&#x27;, cmd : &#x27;mceMoveForward&#x27;});
			ed.addButton(&#x27;movebackward&#x27;, {title : &#x27;layer.backward_desc&#x27;, cmd : &#x27;mceMoveBackward&#x27;});
			ed.addButton(&#x27;absolute&#x27;, {title : &#x27;layer.absolute_desc&#x27;, cmd : &#x27;mceMakeAbsolute&#x27;});
			ed.addButton(&#x27;insertlayer&#x27;, {title : &#x27;layer.insertlayer_desc&#x27;, cmd : &#x27;mceInsertLayer&#x27;});

			ed.onInit.add(function() {
				var dom = ed.dom;

				if (tinymce.isIE)
					ed.getDoc().execCommand(&#x27;2D-Position&#x27;, false, true);
			});

			&#x2F;&#x2F; Remove serialized styles when selecting a layer since it might be changed by a drag operation
			ed.onMouseUp.add(function(ed, e) {
				var layer = findParentLayer(e.target);
	
				if (layer) {
					ed.dom.setAttrib(layer, &#x27;data-mce-style&#x27;, &#x27;&#x27;);
				}
			});

			&#x2F;&#x2F; Fixes edit focus issues with layers on Gecko
			&#x2F;&#x2F; This will enable designMode while inside a layer and disable it when outside
			ed.onMouseDown.add(function(ed, e) {
				var node = e.target, doc = ed.getDoc(), parent;

				if (tinymce.isGecko) {
					if (findParentLayer(node)) {
						if (doc.designMode !== &#x27;on&#x27;) {
							doc.designMode = &#x27;on&#x27;;

							&#x2F;&#x2F; Repaint caret
							node = doc.body;
							parent = node.parentNode;
							parent.removeChild(node);
							parent.appendChild(node);
						}
					} else if (doc.designMode == &#x27;on&#x27;) {
						doc.designMode = &#x27;off&#x27;;
					}
				}
			});

			ed.onNodeChange.add(t._nodeChange, t);
			ed.onVisualAid.add(t._visualAid, t);
		},

		getInfo : function() {
			return {
				longname : &#x27;Layer&#x27;,
				author : &#x27;Moxiecode Systems AB&#x27;,
				authorurl : &#x27;http:&#x2F;&#x2F;tinymce.moxiecode.com&#x27;,
				infourl : &#x27;http:&#x2F;&#x2F;wiki.moxiecode.com&#x2F;index.php&#x2F;TinyMCE:Plugins&#x2F;layer&#x27;,
				version : tinymce.majorVersion + &quot;.&quot; + tinymce.minorVersion
			};
		},

		&#x2F;&#x2F; Private methods

		_nodeChange : function(ed, cm, n) {
			var le, p;

			le = this._getParentLayer(n);
			p = ed.dom.getParent(n, &#x27;DIV,P,IMG&#x27;);

			if (!p) {
				cm.setDisabled(&#x27;absolute&#x27;, 1);
				cm.setDisabled(&#x27;moveforward&#x27;, 1);
				cm.setDisabled(&#x27;movebackward&#x27;, 1);
			} else {
				cm.setDisabled(&#x27;absolute&#x27;, 0);
				cm.setDisabled(&#x27;moveforward&#x27;, !le);
				cm.setDisabled(&#x27;movebackward&#x27;, !le);
				cm.setActive(&#x27;absolute&#x27;, le &amp;&amp; le.style.position.toLowerCase() == &quot;absolute&quot;);
			}
		},

		&#x2F;&#x2F; Private methods

		_visualAid : function(ed, e, s) {
			var dom = ed.dom;

			tinymce.each(dom.select(&#x27;div,p&#x27;, e), function(e) {
				if (&#x2F;^(absolute|relative|fixed)$&#x2F;i.test(e.style.position)) {
					if (s)
						dom.addClass(e, &#x27;mceItemVisualAid&#x27;);
					else
						dom.removeClass(e, &#x27;mceItemVisualAid&#x27;);

					dom.addClass(e, &#x27;mceItemLayer&#x27;);
				}
			});
		},

		_move : function(d) {
			var ed = this.editor, i, z = [], le = this._getParentLayer(ed.selection.getNode()), ci = -1, fi = -1, nl;

			nl = [];
			tinymce.walk(ed.getBody(), function(n) {
				if (n.nodeType == 1 &amp;&amp; &#x2F;^(absolute|relative|static)$&#x2F;i.test(n.style.position))
					nl.push(n); 
			}, &#x27;childNodes&#x27;);

			&#x2F;&#x2F; Find z-indexes
			for (i=0; i&lt;nl.length; i++) {
				z[i] = nl[i].style.zIndex ? parseInt(nl[i].style.zIndex) : 0;

				if (ci &lt; 0 &amp;&amp; nl[i] == le)
					ci = i;
			}

			if (d &lt; 0) {
				&#x2F;&#x2F; Move back

				&#x2F;&#x2F; Try find a lower one
				for (i=0; i&lt;z.length; i++) {
					if (z[i] &lt; z[ci]) {
						fi = i;
						break;
					}
				}

				if (fi &gt; -1) {
					nl[ci].style.zIndex = z[fi];
					nl[fi].style.zIndex = z[ci];
				} else {
					if (z[ci] &gt; 0)
						nl[ci].style.zIndex = z[ci] - 1;
				}
			} else {
				&#x2F;&#x2F; Move forward

				&#x2F;&#x2F; Try find a higher one
				for (i=0; i&lt;z.length; i++) {
					if (z[i] &gt; z[ci]) {
						fi = i;
						break;
					}
				}

				if (fi &gt; -1) {
					nl[ci].style.zIndex = z[fi];
					nl[fi].style.zIndex = z[ci];
				} else
					nl[ci].style.zIndex = z[ci] + 1;
			}

			ed.execCommand(&#x27;mceRepaint&#x27;);
		},

		_getParentLayer : function(n) {
			return this.editor.dom.getParent(n, function(n) {
				return n.nodeType == 1 &amp;&amp; &#x2F;^(absolute|relative|static)$&#x2F;i.test(n.style.position);
			});
		},

		_insertLayer : function() {
			var ed = this.editor, dom = ed.dom, p = dom.getPos(dom.getParent(ed.selection.getNode(), &#x27;*&#x27;)), body = ed.getBody();

			ed.dom.add(body, &#x27;div&#x27;, {
				style : {
					position : &#x27;absolute&#x27;,
					left : p.x,
					top : (p.y &gt; 20 ? p.y : 20),
					width : 100,
					height : 100
				},
				&#x27;class&#x27; : &#x27;mceItemVisualAid mceItemLayer&#x27;
			}, ed.selection.getContent() || ed.getLang(&#x27;layer.content&#x27;));

			&#x2F;&#x2F; Workaround for IE where it messes up the JS engine if you insert a layer on IE 6,7
			if (tinymce.isIE)
				dom.setHTML(body, body.innerHTML);
		},

		_toggleAbsolute : function() {
			var ed = this.editor, le = this._getParentLayer(ed.selection.getNode());

			if (!le)
				le = ed.dom.getParent(ed.selection.getNode(), &#x27;DIV,P,IMG&#x27;);

			if (le) {
				if (le.style.position.toLowerCase() == &quot;absolute&quot;) {
					ed.dom.setStyles(le, {
						position : &#x27;&#x27;,
						left : &#x27;&#x27;,
						top : &#x27;&#x27;,
						width : &#x27;&#x27;,
						height : &#x27;&#x27;
					});

					ed.dom.removeClass(le, &#x27;mceItemVisualAid&#x27;);
					ed.dom.removeClass(le, &#x27;mceItemLayer&#x27;);
				} else {
					if (le.style.left == &quot;&quot;)
						le.style.left = 20 + &#x27;px&#x27;;

					if (le.style.top == &quot;&quot;)
						le.style.top = 20 + &#x27;px&#x27;;

					if (le.style.width == &quot;&quot;)
						le.style.width = le.width ? (le.width + &#x27;px&#x27;) : &#x27;100px&#x27;;

					if (le.style.height == &quot;&quot;)
						le.style.height = le.height ? (le.height + &#x27;px&#x27;) : &#x27;100px&#x27;;

					le.style.position = &quot;absolute&quot;;

					ed.dom.setAttrib(le, &#x27;data-mce-style&#x27;, &#x27;&#x27;);
					ed.addVisual(ed.getBody());
				}

				ed.execCommand(&#x27;mceRepaint&#x27;);
				ed.nodeChanged();
			}
		}
	});

	&#x2F;&#x2F; Register plugin
	tinymce.PluginManager.add(&#x27;layer&#x27;, tinymce.plugins.Layer);
})();
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
